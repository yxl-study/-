# 计算机网络

***

## 第一章

### 1.算机网络在信息时代的作用？

计算机网络由一种 通信基础设施 发展成为一种重要的 信息服务基础设施，成为我们生活中不可缺少的一部分。

### 2.因特网的概述

#### 2.1 网络、互联网和因特网

网络

是由若干个 结点（ Node 结点可以比作为需要使用网络的机器）和连接这些结点的 链路（Link 分为有线链路和无线链路，有线链路：通过数据线等各种导线连接。无线链路：通过无线网连接。） 组成。

【自我理解】

各个机器通过有线或者无线网进行联连接，共同组成网络这个概念。

互联网

多个网络还可以通过路由器进行连接，这样就构成了一个范围更大的网络，即互联网（互连网），因此互联网是 网络的网络

因特网

是世界上最大的互连网络（用户数以亿计，互连的网络数以百万计）

【区分】

internet：互联网，通用名词，它泛指由多个计算机网络互连而成的网络，在这些网络之间的通协议可以是任意的。

Internet： 因特网，专有名词，它指的是当前全球最大的，开放的，由众多网络相互连接而成的特定的计算机网络，它采用 Tcp/Ip 协议族作为通信的规则，前身是美国的ARPANET。

---



#### 2.2 因特网发展的三个阶段

![image-20210705003324071](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705003324071.png)



因特网服务提供者 ISP（Internet Service Provider)

![image-20210705003608470](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705003608470.png)

​		每个独立的 ISP 可以向因特网申请使用权，得到一个 IP 地址，用户通过缴纳费用，可以在 ISP 中获得相应的 IP 地址（因为因特网上的主机必须有IP地址才能进行通信，这样就能通过ISP进入因特网。）我国主要的 ISP 是中国电信，中国移动，中国联通这三大电信运营商。

基于ISP的三层结构的因特网

![image-20210705004911463](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705004911463.png)

第一层结构：

主干网，国际性区域，全球间的互联

第二层结构：

国家性或区域性覆盖规模，主要是一些大公司的使用，例如：电信，移动等

第三层结构：

是各大用户用的，例如：校园网，本地用户等



#### 2.3 因特网的标准化工作

![image-20210705005954366](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705005954366.png)



#### 2.4 因特网的组成

![image-20210705010605119](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705010605119.png)



### 3.三种交换方式

#### 1.电路交换

![image-20210705162134509](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705162134509.png)

【自我理解：什么是电路交换？】

电路交换就像是抗战时期的电话，各个地方的电话不能直接进行交流，而是通过电话总站，接线员将不同省份的区域的电话连接在一起，从而不同区域的电话之间都可以进行交流。所以通过电话交换机接通电话线线进行交流的方式称之为 电路交换

但不适用于计算机之间的交流，因为传到效率低。



#### 2.分组交换（重点）

在因特网中，最重要的分组交换机就是路由器。它负责互联起来，并对接受到的分组进行转发，也就是所谓的分组交换

![image-20210705163817730](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705163817730.png)





#### 3.报文交换

报文交换用于早期的电报交流，目前早已被取代，所以在此就不过多的介绍了。



#### 4.三种方式的对比

![image-20210705164911815](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705164911815.png)



### 4.计算机网络的定义和分类

#### 1.计算机网络的定义

![image-20210705173537479](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705173537479.png)



#### 2.计算机网络的分类

![image-20210705174131085](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705174131085.png)

【按使用者分类】

公用网：

电信公司出资建立的大型网络，公用的意思就是 所有愿意按电信公司的规定缴纳费用的人都可以使用这种网络，因此公用网又称为公众网

专用网：

某个部门为本单位的特殊业务工作的需要而建造的网络，这种网络不向本单位以外的人提供网络，例如：军队，银行

【按传输介质分类】

有线网络：

有线网络包括 双绞线网络，光纤网络等

无线网络：

WiFi

【按覆盖范围分类】

广域网 WAN ：

范围覆盖几千公里，覆盖一个国家甚至横跨几个州，也称为 远程网，是因特网的核心部分，其任务是为核心路由器提供远距离高速连接，互联分布在不同区域城域网或局域网。

城域网 MAN ：

城域网的覆盖范围一般是一个城市，作用距离为5-50公里，通常作为城市骨干网，互联大量企业，机构，和校园局域网

局域网 LAN ：

局域网一般用微型计算机或者工作站通过高速通信线路连接，速率通常在10Mbit/s 以上，范围在一公里左右，一般为一栋楼，一个校园，一个校园大多有多个局域网，局域网通常由某个单位单独拥有，使用和维护。

个域网 PAN ：

个人区域网络的简称，不同于上述网络，并不是用来连接计算机的，而是在个人工作的地方吧属于飞人使用的电子设备（打印机、鼠标、键盘、耳机等）用无线技术连接起来的网络，也称之为无线个人区域网络（WPAN），覆盖范围约10米

注意：若中央处理器之间的范围仅一米或者更小，这就不称为计算机网络了，而称之为 多处理机系统。

【按拓扑结构分类】

总线型网络:

优点：建网容易，增减结点方便，节省线路；

缺点：重负载时，通信效率不高，总线任意一处出现故障，则全网瘫痪。

![image-20210705183107374](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705183107374.png)

星型网络：

优点：将每个计算机都已单独的线路与中央设备相连。中央设备早期是计算机，集成器，现在一般是交换机和路由器，这种网络拓扑便于网络的集中控制和管理，因为端用户之间的通信必须经过中央设备

缺点：成本高，中央设备对故障敏感



![image-20210705183436746](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705183436746.png)

环形网络：

将所有的计算机网络接口连接成一个环。环可以是单环也可以是双环，环中信号是单向传出的。![image-20210705184124841](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705184124841.png)

网状型网络：

一般情况下，每个结点至少由两条路径与其他结点相连，多用于广域网中

优点：可靠性高

缺点：控制复杂，线路成本高![image-20210705184405468](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705184405468.png)

【注意】

以上四种网络可以互相连接为更复杂的网络。

### 5.计算机网络的性能指标

##### 1.速率

由比特引出速率

![image-20210705223334652](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705223334652.png)

![image-20210705224012653](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705224012653.png)

在计算题中，要多注意数据的转化，M不可以直接约掉，不要钻牛角尖。

##### 2.带宽

![image-20210705225326735](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210705225326735.png)

带宽越宽，所传输的 最高数据率也越高。

##### 3.吞吐量

![image-20210707003201394](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707003201394.png)

##### 4.时延

时延在此可以辅助的理解为 时间 

![image-20210707004733684](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707004733684.png)



![image-20210707004800784](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707004800784.png)

在处理时延忽略不计的情况下，要看谁占主导，得通过计算才能知道。

【四种指标的总结】

![image-20210707005133481](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707005133481.png)



##### 5.时延带宽积

![image-20210707005320608](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707005320608.png)



##### 6.往返时间

![image-20210707005507050](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707005507050.png)

源主机发送信号开始，直到源主机收到信号的时间，也就是两次信号传播的时间

在此，分组卫星链路中耗时较多，因为卫星链路的距离较远，同步卫星3600公里，所以时延在此所消耗的时间较多。



##### 7.利用率

![image-20210707010541648](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707010541648.png)



##### 8.丢包率

![image-20210707010801902](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707010801902.png)

【以上四个指标总结如下】

![image-20210707010844859](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707010844859.png)



### 6.计算机网络体系结构（重点）

#### 1.常见的计算机网络体系结构

![image-20210707130056832](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210707130056832.png)



OSI体系结构： 

开放系统互联参考模型，该模型是七层协议的体系结构，法律上的国际标准。

TCP/IP体系结构：

IP协议：网际协议，因此TCP/IP协议的网络层又被称为 网际层

TCP/IP协议只有四层协议的体系结构，是事实上的国际标准

---



![image-20210709220237990](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210709220237990.png)



上图中中间的 R 代表的是：路由器 》路由器只有两种层数，但是为了方便连接，几乎所有的连接器都有 网络接口层 ，所以这里就默认为 网络接口层 并不是一个层，所以真正意义上 TCP/IP 协议只有三层。

---



![image-20210709221013845](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210709221013845.png)

网际层核心：IP协议

运输层核心：TCP和UDP协议

应用层核心：HTTP\SMTP\DNS\RTP协议

【协议之间的关系】 

IP协议将各种网络接口进行互相连接，使各种网络接口之间能够进行信息互传，并向其上的TCP/UDP协议提供网络互连服务 >> 而TCP协议在享受IP协议提供的网络互连服务的基础上,可向应用层的相应协议提供 (可靠传输)的服务,而UDP协议在享受IP协议提供的网络互连服务的基础上,可向应用层提供(不可出传输)的服务.

---



![image-20210709223436387](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210709223436387.png)

在整个网络层数中,IP协议是核心,由图可知,IP协议既与网络接口层紧密连接,又与上两层相联系,所以IP协议是真正意义上的核心,这三种层数包括了很多种协议,其中IP\TCP协议为主,所以将整个层数的名称统称为: TCP/IP协议族 也常称为: TCP/IP协议栈 (因为该协议的分层图与数学中的栈类似).

![image-20210709224459106](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210709224459106.png)

这张图直观的表明了,在教学中,中和了OSI协议和TCP/IP协议的特点,衍生出适用于教学的 原理体系结构,由图可知,TCP/IP协议中的网络接口层变成了 物理层和数据链路层 .

***



#### 2.计算机网络体系结构分层的必要性

![image-20210710131237109](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210710131237109.png)

【注意】

第一:严格来说，传输媒体不属于物理层，它并不包含在体系结构中。

第二：计算机之间的传播信号，并不是方波信号，之所以用方波信号举例，是为了让初学者更容易理解信号传输的特点。

---



![image-20210710132033454](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210710132033454.png)

以上显示的总线型主机网已经淘汰，目前多使用以太网交换机将多台主机互联形成的交换式以太网。



![image-20210713140609849](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210713140609849.png)

到这里，此时会发现只要解决了物理层和数据链路层，就可以将分组在一个网络上传输了。在我们平常使用的因特网中，是有多个路由器和众多网络共同构成的，只能解决物理层和数据链路层的问题，还是不能正常工作。

---



![image-20210715152200145](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715152200145.png)



第一：

该类IP地址的前三个十进制数数用来标识网络，第四个十进制数用来标识主机，该网络上的笔记本电脑，服务器，以及路由器接口的IP地址的前三个数都是  192，168，1 （网络N1中的数据）因为他们都是连接在同一个网络中。然而第四个数为 1 .用来表示他们自己，也就是类似于产品序列参数

第二：

网络传输途径远不止一条，分组，从源主机到目的主机可以走的路有很多条。因此引出上图问题。

至此：我们解决了 物理层，数据链路层，网络层的问题，可以实现数据在网络中分组传输的问题。

---



![image-20210715151022949](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715151022949.png)

至此我们解决了运输层与之前三层的问题，则可以实现进程之间基于网络的通信

---



![image-20210715153246648](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715153246648.png)



![image-20210713141103480](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210713141103480.png)

***



#### 3.计算机网络体系结构分层思想举例

![image-20210715162539209](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715162539209.png)

举例：左下角是主机，右下角是web网络

【总体过程简述】：

在网址栏中输入网址，以 http 为例，输入网址后，主机将请求信号通过网络 N1 发送给路由器，再通过网络 N2 发送给web网络，然后web网络同样的将收到的信号编辑好以后发送回主机中，对请求的网络地址进行相应的反应。

---

【详细过程】

以主机上的浏览器应用进程与web服务器中的web服务进程之间基于网络的通信。

过程一：

![image-20210715163958857](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715163958857.png)

应用层按照 HTTP 的协议构建出 HTTP报文，详细部分为报文的内容。

应用层将HTTP报文交付给运输层处理。

![image-20210715165802983](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715165802983.png)

运输层给 HTTP 添加一个TCP首部，使之成为TCP报文段，该首部的作用 ：为了区分应用进程以及实现可靠传输。

运输层将TCP报文段交付给网络层处理。

![image-20210715170142919](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715170142919.png)

网络层给TCP报文段添加一个IP首部，使之成为IP数据报。该首部的作用主要是使IP数据报可以在互联网上传输，也就是被路由器转发。

网络层将IP数据报交付给数据链路层处理。

![image-20210715170710421](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715170710421.png)

数据链路层给IP数据添加一个首部和一个尾部使之成为帧，

假设网络N1是以太网，

![image-20210715171025904](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715171025904.png)

这是帧首部的格式，该首部的作用是为了让帧能够在一段链路上或一个网络上传输，能够被相应的目的主机接收。

![image-20210715171244250](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715171244250.png)

这是以太网帧尾部的格式，其作用是为了让目的主机检查所接收到的帧是否有误码。

数据链路层将帧交付给物理层。

![image-20210715171605821](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715171605821.png)

物理层将帧视为 比特流 ，又因为N1是因特网，所以物理层又会在比特流的前面加上 前导码，成为前导码比特流，变成相应的信号发送到传输媒体，

![image-20210715171933875](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715171933875.png)

信号通过传输媒体到达路由器。再来看路由器的转化过程，

物理层将信号变为比特流，然后去掉 前导码，将其交付给数据链路层，实际上交付的是帧。

![image-20210715172308524](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715172308524.png)

数据链路层 将帧的首部和尾部去掉后成为IP数据报，将其交付给网络层。

![image-20210715172347666](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715172347666.png)

网络层解析IP数据报的首部，从中提取出目的网络地址，然后查找自身的路由表，确定转发端口，以便进行转发。

![image-20210715173155365](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715173155365.png)

网络层将IP数据报交付给链路层，链路层给IP数据报添加一个首部和一个尾部使之成为帧，数据链路层将帧交付给物理层。

![image-20210715173538809](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715173538809.png)

物理层将帧看作是比特流，由于N2是以太网，所以物理层又将比特流添加前导码，添加有前导码的比特流，转化为信号发送到传输媒体

![image-20210715173829043](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715173829043.png)

信号通过传输媒体到达web服务器，来看web服务器的处理过程。

物理层接收到信号，将其转化为比特流，去掉前导码，将其交付给数据链库层，数据链路层将帧的首部和尾部去掉，将其交付给网络层，实际上交付的是 IP数据报，网络层将IP首部去掉，使之成为TCP报文段，交付给运输层，运输层将TCP首部去掉，使之成为HTTP请求报文，交付给应用层，应用层对HTTP请求报文进行解析，然后给主机发回HTTP响应报文。

响应报文的返回流程与之前的发送流程一致。

![image-20210715174910576](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210715174910576.png)

最终主机浏览器得到 HTTP 响应报文后，对HTTP网址进行相应的响应，跳转到相应的页面。

***



#### 4.计算机网络体系结构中的专用术语

 ![image-20210716103018439](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716103018439.png)

首先介绍三个概念：实体，协议，服务

![image-20210716103108718](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716103108718.png)左右两列为不同应用进程的五个层次，由此引出实体的概念，实体和对等实体，如上图所示，其中对等实体就是指：相同层次的应用进程或者网卡都可以称之为对等实体。

---



![image-20210716103601365](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716103601365.png)



协议：控制两个对等实体进行逻辑通信的规则的集合

逻辑通信：是因为这种通信其实并不存在，是我们假设出来的一种表示方式

协议的三要数：语法，语义，同步

【语法】

以IP数据报为例

![image-20210716104151965](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716104151965.png)

其中的小格子称为字段或域；数字表示字段的长度，单位是位（也就是比特）。

语法就是定义了这些小格子的长度和先后顺序。换句话说，语法就是定义了所交换信息由哪些字段以及何种顺序构成。

---

【语义】

![image-20210716104827076](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716104827076.png)

就是在1.6.3中一样的操作，先由浏览器构建HTTP请求报文，经过层层包装，由物理层将数据信息发送给WEB网络中，在经过册层层包装，web网络将HTTP请求报文进行解析，返回一个HTTP响应报文，再经过测过层层包装，由web网络将响应报文发送给 浏览器，同样的经过层层退包装，最终在浏览器的应用层将HTTP响应报文进行解析，然后浏览器呈现出想要访问的内容。

---

【同步】

![image-20210716104056797](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716104056797.png)

同步：定义收发双方的时序关系，并不是指的是频率同步

---

服务

![image-20210716111920884](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716111920884.png)

举例辅助解释：

就好比手机，我们在享受着手机给我们带来的服务，但是我们看不见服务间的协议，不需要弄懂手机的原理。

---



![image-20210716112257356](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716112257356.png)



![image-20210716112416161](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716112416161.png)



![image-20210716112456130](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716112456130.png)

***

### 7.本章总结

依据视频做思维导图

### 8.第一章习题（体系结构）

第一题

![image-20210716225107351](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716225107351.png)

![image-20210716225015607](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716225015607.png)

由图详细可知：端到端也就是两个应用进程之间的逻辑通信，是在传输层实现的

---

第二题

![image-20210716225604762](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716225604762.png)

本题可以使用排除法，第一个图排除了AD选项，第二个图排除了B选项。

---

第三题

![image-20210716230024519](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716230024519.png)

本题要记住TCP/IP的参考协议的四种模型。记住本题答案。

---

第四题

![image-20210716230741656](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716230741656.png)

![image-20210716231000210](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716231000210.png)

![image-20210716231117045](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716231117045.png)

![image-20210716231156908](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716231156908.png)

---

第五题

![image-20210716231858370](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716231858370.png)

---

第六题

![image-20210716232028445](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232028445.png)

---

第七题

![image-20210716232215292](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232215292.png)

![image-20210716232237216](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232237216.png)

![image-20210716232256245](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232256245.png)

---

第八题

![image-20210716232405939](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232405939.png)

本章中并未提及该考点内容，作为了解

![image-20210716232505910](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232505910.png)

路由器这里指的是：R1

![image-20210716232543225](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232543225.png)

交换机这里指的是：Switch

![image-20210716232623109](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232623109.png)

集线器这里指的是:Hub

---

第九题

![image-20210716232930823](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716232930823.png)

![image-20210716233000799](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233000799.png)

![image-20210716233015714](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233015714.png)

![image-20210716233050700](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233050700.png)

![image-20210716233106563](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233106563.png)

![image-20210716233124248](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233124248.png)

![image-20210716233143835](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233143835.png)

![image-20210716233221704](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233221704.png)

![image-20210716233234402](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233234402.png)

![image-20210716233251222](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233251222.png)

![image-20210716233307503](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233307503.png)

这里注意：数据链路层总共添加的是20字节，并不是首部尾部都是20字节。

![image-20210716233626711](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233626711.png)

---

第十题

![image-20210716233704927](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233704927.png)

![image-20210716233745210](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233745210.png)

![image-20210716233827818](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233827818.png)

![image-20210716233943933](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716233943933.png)

![image-20210716234006197](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210716234006197.png)



---

### 9.第一章习题（时延）重点

![image-20210717081658986](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717081658986.png)

![image-20210717082157835](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717082157835.png)

由上图可知：当带宽为8Mb/s时，发送出去的为8个比特，相较于带宽为1Mb/s的一比特来说，增大带宽，也就是增大了发送速率。

![image-20210717082848350](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717082848350.png)

例题：

![image-20210717083349746](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717083349746.png)

分析题干：总耗费时间 = 发送时延 + 传播时延

此题中涉及到两个距离的问题，发送时延也是有路程的，计算时，注意两个路程的计算。

【注意】

在这里计算时，在计算传播时延的过程中，发送时延所经过的路程并不会删除掉，在计算传播时延中，图中黄色部分要从头到尾完整经过才算是一个完整的距离，所以也就相当于不删除发送时延的距离。![image-20210717095034697](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717095034697.png)



![image-20210717095229517](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717095229517.png)

依据上题可知：在计算N 个比特传播时，错误的将一个比特传播时间乘以N，那这种计算方式是错误的，因为不论有几个比特，它总的传播时延只有一个，而上述的方法是将传时延以N 个来计算了。

![image-20210717095750481](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717095750481.png)

由上图可以看出，总传播时间 = 所有比特的发送时延 + 一个传播时延

![image-20210717100002110](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100002110.png)

![image-20210717100020330](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100020330.png)

![image-20210717100041677](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100041677.png)

![image-20210717100114962](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100114962.png)

![image-20210717100129604](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100129604.png)

![image-20210717100145408](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100145408.png)

---

![image-20210717100236558](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100236558.png)

![image-20210717100702454](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100702454.png)

结论：有前提：就是假设的内容

![image-20210717100746841](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717100746841.png)

---

练习题1：

![image-20210717101211038](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717101211038.png)



练习题2：

![image-20210717145356410](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717145356410.png)

练习题3：

![image-20210717145648338](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717145648338.png)

![image-20210717145618706](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717145618706.png)

练习题4:

![image-20210717145732812](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210717145732812.png)

***



## 第二章

### 1.物理层的基本概念

![image-20210719093523902](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719093523902.png)



物理层包含两种传输媒体：

1.【导引型传输媒体】

双绞线，同轴电缆，光纤

2.【非引导型传输媒体】

微波通信（wifi）

物理层的作用：

将比特流转化成数字信号，用机械语言为数据链路层提供服务，数据链路层只要将接受到的信号传递给上一层即可，数据链路层不用管物理层是通过何种方式将信号传输给数据链路层的，只在乎传输的结果。

![image-20210719095602522](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719095602522.png)

***

### 2.物理层下面的传输媒体

【导引型传输媒体】

同轴电缆

![image-20210719100852823](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719100852823.png)



双绞线

![image-20210719101800452](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719101800452.png)



屏蔽双绞线STP电缆：

外层由绝缘层包裹，内层还用金属丝包裹，更加减少电磁波的干扰。

光纤

![image-20210719104021448](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719104021448.png)



![image-20210719104816762](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719104816762.png)



![image-20210719104920557](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719104920557.png)



![image-20210719110130119](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719110130119.png)



电力线

![image-20210719111000021](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719111000021.png)



【非导引型传输媒体】

无线电波

![image-20210719142616564](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719142616564.png)



微波

一种是：地面微波接力通信   另一种是：卫星通信

为实现远距离通信，必须在一条微波通信信道的两个终端之间建立若干个中继站。

![image-20210719143353851](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719143353851.png)

红外线

![image-20210719143539933](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719143539933.png)



可见光

LIFI 通信，利用可见光进行通信，目前阶段还在实验中

![image-20210719144128462](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719144128462.png)



***

### 3.传输方式

![image-20210719145045378](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719145045378.png)

串行传输： 一个比特一个比特的传输，在发送端和接收端之间只需要一条数据传输线路即可。

并行传输：n个比特同时传输，在发送端和接收端之间需要有n条传输线路。

并行传输的优点为串行传输的n倍。

在发送端和接收端远距离传输之间，使用的是 串行传输

在电脑内部，例如cpu与内存之间是通过总线进行数据传输，也就是 并行传输。

![image-20210719151158939](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719151158939.png)

---

![image-20210719151734419](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719151734419.png)

同步传输：

所有字节同时发送，字节间没有空隙，但在发送端和接受端之间会有很多的误差因素，因此要进行多方面的同步措施，以减少误差。

![image-20210719154230109](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719154230109.png)



异步传输：

字节一段一段的传输，在传输字节时，在字节的首尾部要加上特定的部分，方便接收时不出现误差。

![image-20210719154511754](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719154511754.png)

---



![image-20210719154636933](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210719154636933.png)

单向通信：

单方面通信，只要一条通信道路。例如：收音机，广播

双向交替通信：

互相通信，但是不能同时进行，两条通信道路，例如：对讲机

双向同时通信：

互相同时通信，两条通信道路，例如：手机

***

### 4.编码与调制

![image-20210720220741030](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720220741030.png)

分析上图：

数据是运送消息的实体》计算机只能处理二进制数据，也就是比特0和比特1》计算机中的网卡将比特信号转变为电信号发送给网线》信号是数据的电磁表现》由信源发出的原始电信号称为基带信号》基带信号有两种，一是数字基带信号，二是音频基带信号》数字基带信号是电脑内部所用的信号》音频基带信号是麦克风收到的信息转化成的信号》信号要在信道中传输，以太网中的信号通过编码可在数字信道中传输，WIFI中的信号通过调制可在模拟信道中传输，模拟基带信号中的传输原理也是如此。

码元：

简单来说，码元就是构成数字信号的一段波形。

传输媒体与信道的关系：

![image-20210720222925686](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720222925686.png)

传输媒体	！=	信道

在单工传输中：传输媒体中只有一条信道，要么是发送信道要么是接受信道

在半双工或者全双工信道中，有两条信道

一条传输媒体还可以包含多条信道，在计算机网络中，常见的是将数字基带信号通过编码和调制在传输媒体的信号中传输

---

![image-20210720224920850](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720224920850.png)

![image-20210720225108631](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720225108631.png)

归零编码编码效率低。

![image-20210720225203980](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720225203980.png)

练习题

![image-20210720225355098](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720225355098.png)

---

【基本调制方法】

![image-20210720225528982](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720225528982.png)

![image-20210720225553378](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720225553378.png)

采用混合调制的方法：使得一个码元包含多个比特信息。

![image-20210720230005705](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720230005705.png)

![image-20210720230021733](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720230021733.png)



![image-20210720230142668](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720230142668.png)

图中绿色的圆点代表的是码元

![image-20210720230831597](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720230831597.png)

![image-20210720230946225](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720230946225.png)



![image-20210720231007878](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210720231007878.png)

***



### 5.信道的极限容量

![image-20210721144342139](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721144342139.png)

![image-20210721144854446](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721144854446.png)

图中调幅 、调频、调相，都属于二元制，只能产生两种不同的码元。

混合调制属于多元调制，可以产生16种码元。

---

![image-20210721145241802](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721145241802.png)

![image-20210721145317959](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721145317959.png)



练习题

![image-20210721145505806](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721145505806.png)

右侧数据为电测波的传输速率

![image-20210721145740237](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721145740237.png)



![image-20210721145850347](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721145850347.png)



![image-20210721150006270](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721150006270.png)



![image-20210721150037819](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721150037819.png)



总结

![image-20210721150105644](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721150105644.png)

***

### 6.本章总结

用思维导图进行总结

***

### 7.第二章习题课

***



## 第三章

### 1.数据链路层的概述

![image-20210721220737713](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721220737713.png)

红色箭头所指的过程是在第一章讲过的数据传输过程，而在此数据链路层的概述中可以仅考虑数据链路层的问题，如图所示：

![image-20210721221026107](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221026107.png)

![image-20210721221125851](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221125851.png)

要了解数据链路和链路的概念。

---

![image-20210721221415354](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221415354.png)

封装成帧的过程如上图所示：

---

![image-20210721221622391](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221622391.png)

![image-20210721221637692](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221637692.png)

![image-20210721221652867](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221652867.png)

![image-20210721221712744](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221712744.png)

![image-20210721221724202](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221724202.png)

![image-20210721221732925](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221732925.png)

![image-20210721221746377](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221746377.png)

![image-20210721221800980](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221800980.png)

![image-20210721221820777](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221820777.png)

![image-20210721221831328](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221831328.png)

![image-20210721221846351](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221846351.png)

![image-20210721221900778](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221900778.png)

![image-20210721221912991](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221912991.png)

![image-20210721221923206](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221923206.png)

![image-20210721221935359](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221935359.png)

![image-20210721221946160](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221946160.png)

![image-20210721221956722](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721221956722.png)

![image-20210721222021792](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721222021792.png)

![image-20210721222107769](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721222107769.png)

![image-20210721222123906](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721222123906.png)

---

![image-20210721222241373](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721222241373.png)



如果只要A和C接收到对应的信息：因为图中所示的是一条总线连接的电脑，所以就像是串联的模式，此时看上层交付的协议数据单元，其中的帧头和帧尾中包含了目的地址和源地址，由此各个主机就可以判断主机本身是否该接受帧了。

**![image-20210721222708916](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721222708916.png)**

![image-20210721224203041](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721224203041.png)

![image-20210721224319679](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721224319679.png)

![image-20210721224359607](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721224359607.png)

![image-20210721224420013](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210721224420013.png)

***

### 2.封装成帧

![image-20210722001251452](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001251452.png)

![image-20210722001306292](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001306292.png)

![image-20210722001318320](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001318320.png)

![image-20210722001330700](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001330700.png)

![image-20210722001347179](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001347179.png)

![image-20210722001357977](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001357977.png)

![image-20210722001448568](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001448568.png)

![image-20210722001506587](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001506587.png)

【帧定界】

![image-20210722001529927](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001529927.png)

![image-20210722001635408](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001635408.png)

![image-20210722001648959](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001648959.png)

![image-20210722001702967](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722001702967.png)

![image-20210722002908090](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722002908090.png)

![image-20210722002922493](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722002922493.png)

![image-20210722002932574](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722002932574.png)

![image-20210722002947830](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722002947830.png)

![image-20210722003005245](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003005245.png)

![image-20210722003016772](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003016772.png)

![image-20210722003032967](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003032967.png)

![image-20210722003051836](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003051836.png)

![image-20210722003107445](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003107445.png)

![image-20210722003124754](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003124754.png)

![image-20210722003223106](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003223106.png)

![image-20210722003233586](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003233586.png)

![image-20210722003249438](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003249438.png)

![image-20210722003302512](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003302512.png)

![image-20210722003322954](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003322954.png)

![image-20210722003331145](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003331145.png)

![image-20210722003348711](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003348711.png)

![image-20210722003405045](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003405045.png)

![image-20210722003415333](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003415333.png)

![image-20210722003428107](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003428107.png)

![image-20210722003446520](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003446520.png)

![image-20210722003458997](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003458997.png)

![image-20210722003507778](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003507778.png)

![image-20210722003516264](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003516264.png)

![image-20210722003535050](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003535050.png)

---

【透明传输】

![image-20210722003550610](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003550610.png)

![image-20210722003628563](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722003628563.png)

在数据链路层中会在数据的首位添加 帧头和帧尾，为了简单起见，我们只画出了帧头和帧尾中的帧定界标志 flag 》帧定界标志也就是一个数值。

思考情况一：

如果在交付的数值当中包含了帧定界标志，接收方还能正确接受该帧吗？

![image-20210722004107231](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722004107231.png)

答案是：不能

分析：

接收方在收到第一个帧定界标志时，会认为该帧定界标志是开始的标志，当接收到第二个帧定界标志时，会认为时结束的标志，所以在接收到第三个标志时，会出现错误。

那各个协议之间如何解决这个问题？

解决方案：

例如：在发送帧之前，对帧的数据部分进行扫描，每出现一个帧定界符，就在其前面插入一个转义字符（ESC），此时，当接收方接收到数据链时，扫描出第一个帧那就是开始的标志，当遇到转义字符ESC时，将其后面的帧定界符中的内容作为数据进行提取，

![image-20210722004852719](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722004852719.png)



思考情况二：

![image-20210722005520928](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722005520928.png)

这其中既包含了帧定界符，又包含了转移字符，该如何处理？

解决方法：仍然是在发送帧之前，对帧的数据部进行扫描，

![image-20210722005911612](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722005911612.png)

每出现一个帧定界符或者一个转义字符，就在其前面插入一个转义字符。需要说明的是，转义字符并不是E,S,C这三个英文字母，转义字符是一个特殊的控制字符，其长度为1字节，十进制值为27

以上介绍的是 面向字节的物理链路

![image-20210722010514899](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722010514899.png)

---

面向比特的物理链路应使用比特填充的方法实现透明传输。

![image-20210722010655406](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722010655406.png)



![image-20210722010720565](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722010720565.png)

对帧进行扫描，![image-20210722011011648](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722011011648.png)

![image-20210722011025098](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722011025098.png)

![image-20210722010822772](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722010822772.png)

![image-20210722011103302](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722011103302.png)

![image-20210722011129180](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722011129180.png)

![image-20210722010835712](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722010835712.png)

---

练习题：

![image-20210722012110686](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722012110686.png)

---

总结：

![image-20210722012132894](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722012132894.png)

![image-20210722012154847](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722012154847.png)



***

### 3.差错检测

![image-20210722081851050](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722081851050.png)

比特差错又称为误码

那接收方如何判断出现误码呢？

![image-20210722082133582](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722082133582.png)

帧的尾部四字包含了一个长度为四字节的帧检验序列FCS字段。

其作用就是让接收方的数据链路层检查，帧在传输过程中是否产生了误码。

![image-20210722082814036](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722082814036.png)

---

![image-20210722082911916](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210722082911916.png)

其帧尾中也包含了一个长度为两字节的帧检验序列FCS字段。

其作用也是让接收方的数据链路层，检查帧在传输过程中是否产生了误码。

---

第二种检错方法：

【奇偶校验】

在待发送数据的后面添加1位奇偶检验位，使得整个数据（包括所添加的校验位在内）中‘1’的个数位奇数（奇校验）或偶数（偶校验）

![image-20210731221414410](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210731221414410.png)

如图所示出现误码现象，假如出现的是误码一个而已，如第一个误码现象，将1变成了0，接收方在检测时依然能够通过检测1的数量来判断是否出现误码，但是如果出现了两个误码现象，如第二个检验可以看出：当两个1出现误码时，1的奇数没有变化，此时接收方就无法检测出误码现象。

所以奇偶检验的方法依然存在漏洞。

---

第三种检测方法

【冗余检错】

![image-20210731224553910](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210731224553910.png)

商：仅仅作为标记，不构成作用

除数：生成多项式各项系数构成的比特串

例如：G=X3+X2+1，此时构成的比特串就是：1101，因为也要计算X1的系数，最后的1就是常数1.

待发送数据：题目中会给出，要在被除数后面加上多项式最高次数的个数0，例如X3，则要加上3个0

余数：最后整个计算式做完，得到的余数就是用来判断是否误码的标准，如果得到的余数不为0，那么就是出现了误码，相反，则没有出现误码，这种方法只是出错率特别低，并不代表不出错。

![image-20210731225428992](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210731225428992.png)

【练习题】

![image-20210731225532984](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210731225532984.png)

分析步骤1：题目中待发送信息为：101001，加上最高次数个零，就变成了：101001000，此时就是除数

分析步骤二：由多项式的各项系数可以得出：1101，注意这里的X1次方也要计算。

分析步骤三：做除法，先找到合适的位置做定位，再用【异或运算】进行计算，然后进行补位，再计算，最终得到一个数字

分析第四步：将得到的数字进行补位，与最高项的次数应该相同，如果不同，用0在其后进行补位。再判断是否为0，如果为0，那就是正确，如果不为0那就是误码.

![image-20210731230827965](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210731230827965.png)

总结：

![image-20210731230857922](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210731230857922.png)

***

### 4.可靠传输

#### 1.基本概念

![image-20210801220348392](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210801220348392.png)

![image-20210801220734630](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210801220734630.png)

总结：在每一层中，是否需要可靠传输是取决于应用的需求，而在每一层中，都可以选择可靠传输，但是相应的成本也就增大了，所以在选择是否需要可靠传输时，需要谨慎选择。

***

#### 2.可靠传输的三种基本协议

![image-20210801221320088](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210801221320088.png)

---

##### 2.1【停止等待协议】

![image-20210808213746052](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210808213746052.png)

这个协议中可靠分组的含义：

由图可知：接收方和发送方之间是通过互联网相连的，当发送方将数据发送给接收方之后，接收方会对发送过来的数据进行数据 检测当数据检测通过后，接受方会发送ACK（确认无误）给发送方，然后发送方再进行下一个数据的发送，如果发送的该数据出现了误码，那么接受方将会发送NAK给发送方，此时发送方知道自己发送的数据出现了误码，这时发送方将会把数据再次发送一边，使其不出现错误，接收方接收后再次确认无误后将ACK发送给发送方。整个过程也就完成了，这只是一个简单的过程介绍，实际的情况比这个要复杂的多。所以这样就能保证发送的数据是正确的，也就是所谓的可靠传输。

![image-20210808215212082](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210808215212082.png)

超时重传

：为了防止发送方发送的数据出现丢失的情况，将启动超时重传的作用，在规定的时间里，发送方未接受到接收方发送的数据，如果时间超时，就会重新再发送一遍，这样与确认与否认相结合，就能确保可靠传输。

其他情况：

![image-20210808215713962](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210808215713962.png)



由图可知：

在发送方的数据上添加上序号，就可以防止出现重复发送数据的错误了，因为在ACK丢失的情况下，会导致数据发送延时，也就是会导致发送方超时重传，此时接收方会将接受到的数据进行判断，判断完成以后就会将重复数据进行丢弃。

其他情况：

![image-20210808220328379](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210808220328379.png)

由图可知：

这里出现的错误是：数据0的超时重传后，接收方将发送ACK第一遍的ACK是因为第一遍的数据发送的返回确认，因为经过超时重传，所以发送方将第二遍发送同样的数据，此时接收方接受到以后就会在此发送ACK，问题就在这：发送方如何判断接受的ACK是第一遍的数据还是第二遍的数据，此时也需要将ACK进行编号，这样发送方就知道接收到的数据是第一遍的还是第二遍的

【说明】

这里的数据编号，都是用0和1来代替，第一遍就是0，完了以后就是1，方便判断。

![image-20210808221259481](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210808221259481.png)

---

计算信道利用率

![image-20210808221616759](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210808221616759.png)

TD:数据分组发送时延

TA：确认分组发送时延

RTT：往返时延

例题：

![image-20210808221944471](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210808221944471.png)



总结：![image-20210808222021768](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210808222021768.png)

停止等待协议的别称

***

##### 2.2【回退N帧协议】

![image-20210810095520342](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810095520342.png)

协议运行：

![image-20210810095630145](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810095630145.png)

以上例题采用3个比特给分组编号

发送窗口是5，也就是可以同时发送5个数据，而接收方并不是同时接受5个数据，而是按序接收5个数据，发送窗口就像是流水线发送，可以同时发送多个数据，而接收方只能接受一个，不能同时接收多个数据，这一点和停止等待协议是一样的。

以上举例是以无差错的情况为例：发送窗口为5，所以将01234同时发送出去，然而接收窗口将一个一个进行接收，每接受一个就会发送一个确认ACK信息返回到发送方，比如接收到0就返回ACK0，接收到1就返回ACK1。当无误差出现时，成功的接受完5个数据之后，就会依次发送后5个数据，然后接收方就继续依次接受5个数据，在进行数据返回值确认，直至数据发送完毕。

---

![image-20210810100800503](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810100800503.png)

【累积确认】

对上述单个确认的升级版，累积确认顾名思义，就是不用接受完一个就确认一个，可以等到全部接受完以后进行统一确认，此时只要确认最后一个接受的数据即可，例如上图：接受完以上5个数据01234之后，接收方只要发送ACK4即可，发送方收到ACK4即表明接收方已经接受完数据，就可以开始发送下一个数据。

累积确认的优点：

即使在最后一个数据确认前，已有数据确认信息丢失都没有关系，例如：在ACK4确认信息收到前，已发送的ACK1,ACK2,ACK3都已经丢失，那也没关系，在发送方接收到ACK4即可，依然能确定接收方已经完全接受数据，

累积确认的缺点：

![image-20210810102116678](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810102116678.png)

发送方在发送数据时，如果发送的数据出现误码，那么接受方就会抛弃该所有数据，进行数据重传，只要接收方接收到的数据与相应的位置不匹配，那么接收方就会对数据进行丢弃处理，从而使得发送方进行数据重传，此时不用等待数据计时器的时间，可以立即重传。

可见：当通信线路质量不好时，回退N帧协议的信道利用率并不比停止等待协议的利用率高。

---

![image-20210810102938538](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810102938538.png)

![image-20210810102959457](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810102959457.png)

![image-20210810103009075](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810103009075.png)

![image-20210810103138178](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810103138178.png)

例如：发送方将确认完的8个数据进行发送，接收方收到8个数据以后，发送方再次发送数据，此时会出现位置重复，导致接收方发送的返回数据确认ACK出现重复，使得发送方无法判断数据是否发送重复。因此，发送数据不要超过发送窗口的尺寸最大值。

![image-20210810104009132](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810104009132.png)

![image-20210810104132977](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810104132977.png)

---



例题：

![image-20210810104054203](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810104054203.png)

***

##### 2.3【选择重传协议】

定义：

![image-20210810152905312](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810152905312.png)

![image-20210810153042354](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810153042354.png)

工作原理：

![image-20210810153530005](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810153530005.png)

例如：

发送窗口为4，接收窗口也是4，发送方将数据发送给接收方，此例中，数据2出现丢失，接收方成功的接受013号数据，并且将确认数据ACK013返回给发送方，接收方接受完01号数据，接收方的窗口就往前移动两格，如图所示，此时接收3号数据，窗口不再移动，因为此时的3号数据是之前未发送完的数据，并不是新的数据，接收方将3号确认ACK返回给发送方，发送方此时就会判断数据2未成功发送给接收方，所以会进行超时重传，发送方每接受一个数据确认分组，就会向前移动一个窗口，

![image-20210810154604490](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810154604490.png)

发送方接收到两个确认分组，就会向前移动两个窗口，此时45两个数据进入发送分组，发送方将45两号数据发送接收方，接收方接收到45两号数据分组后，发送确认分组返回给发送方，在此发送的过程中，接收方的窗口依据不能移动，因为还未收到之前重传的2号数据，在发送方接受到45号数据确认分组的过程中，发送方将2号数据重新发送，当接收方接收到2号数据时，接收方即可向前移动4个 窗口，使得接收窗口处于 6701的位置。

**![image-20210810155430418](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810155430418.png)**

此时发送方的窗口还不能移动，只有当发送方接收到2号的确认分组后，发送方才可以进行向前移动。

---

【尺寸问题】

![image-20210810155620285](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810155620285.png)

![image-20210810155657549](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810155657549.png)

例如：

![image-20210810155734599](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810155734599.png)

![image-20210810155908781](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810155908781.png)

如上可知：

当窗口尺寸都超过限制的时候，一开始发送数据出现了0号数据丢失，1234号数据依旧正常发送，接收方将1234号数据确认分组返回给发送方，此时只有0号数据未返回，接收方在收到四个数据后，会向前移动4个窗口，如上图所示：移动完4个位置以后，其中还有0号数据接受窗口，所以在发送方将0号数据进行数据重传时，接收方就无法判断该数据是新数据还是旧数据，会产生数据传输错误。

---

总结：

![image-20210810160658457](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810160658457.png)

---

例题：

![image-20210810160726656](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810160726656.png)



***

### 5.点对点协议PPP

定义：点对点协议是目前使用最广泛的点对点数据链路层协议。

![image-20210810214340779](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810214340779.png)

由图可知：用户连接到因特网的条件是通过PPP协议，连接到各大运营商，运营商的作用也就相当于梯子，就像是连接到外网，需要的是梯子一个作用，只不过运营商合法的获取了因特网的IP地址。

![image-20210810214642558](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810214642558.png)

![image-20210810214711489](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810214711489.png)

![image-20210810214809486](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810214809486.png)

![image-20210810214854893](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810214854893.png)

![image-20210810214928447](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810214928447.png)

![image-20210810214952855](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810214952855.png)

![image-20210810215019909](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810215019909.png)

![image-20210810215047914](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810215047914.png)

![image-20210810215103608](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210810215103608.png)

***

### 6.媒体接入控制

#### 1.基本概念![image-20210811204350815](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210811204350815.png)

在同一条总线上，多个主机同时发送信息，会产生信息碰撞，导致所有主机都不能正确接收信息。

---



![image-20210811211757393](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210811211757393.png)

![image-20210811211842034](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210811211842034.png)

***

#### 2.静态划分信道

![image-20210812105327272](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812105327272.png)

如图所示:在信道复用的作用下，多条线路可以同时使用一条线路。

---

![image-20210812105553449](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812105553449.png)

如图所示：ABC三种信号，复用器将三种信号调制到不同频率的载波上，然后经过分用器通过滤波将各路信号分开，将合成的复用信号恢复成原始的多路信号。

![image-20210812105938804](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812105938804.png)

---

![image-20210812110045482](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110045482.png)



---

![image-20210812110132301](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110132301.png)

光信号传输会随着距离的增加而减弱，所以此时需要光纤放大器，将光波进行放大，增强光的强度。

---

##### 【以下部分没学会】

![image-20210812110530119](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110530119.png)

![image-20210812110701544](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110701544.png)

![image-20210812110747181](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110747181.png)

![image-20210812110811206](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110811206.png)

![image-20210812110836040](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110836040.png)

![image-20210812110902960](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110902960.png)

![image-20210812110928669](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110928669.png)

![image-20210812110952425](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812110952425.png)

![image-20210812111006350](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812111006350.png)

![image-20210812111034380](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812111034380.png)

***

#### 3.随机接入---总线局域网使用的协议CSMA/CD协议

![image-20210812111358469](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812111358469.png)

![image-20210812113909085](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812113909085.png)

如上图所示：随机接入就是用来解决多主机在发送信号时的信号碰撞问题。

---

4.解决（随机接入）的方法，CSMA/CD协议。

![image-20210812114420030](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812114420030.png)

![image-20210812114403582](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812114403582.png)

过程模拟分析：

![image-20210812115157278](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210812115157278.png)

多址接入：

在一条总线上，ABCD主机都接入在同一条总线上,各主机随机发送帧，加入C主机要发送帧，它首先要进行载波监听，检测到总线空闲96比特的时间后，就可以发送帧了，假如此时主机B也要发送帧，此时主机B也要进行载波监听，发现此时总线忙，于是持续监测总线，一旦发现总线空闲的96比特的时间，就立即发送帧，此时一边发送帧还要一边检测碰撞，只要没有检测到碰撞，即可发送帧的剩余部分，只要主机B和主机C都要发送数据，那么一定会产生信号碰撞，此时的主机B和主机C都在边发送帧边检测碰撞，但是都检测不到碰撞，在总线上检测，主机C要比主机B更早检测到碰撞信号，此时主机C停止发送信号，退避一段时间后![image-20210830080611812](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830080611812.png)

主机C再次发送信号，而后接受的主机B 在主机C发送信号的时间正处于退避时间 ，等主机C发送完毕以后主机B 才开始发送，所以两者很难检测到碰撞。

![image-20210830081259339](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830081259339.png)

---

5.争用期（碰撞窗口）

![image-20210830082321859](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830082321859.png)

 ![image-20210830082341879](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830082341879.png)

由图可知：往返端到端的传播时延就是争用期（碰撞窗口）

---

6.最小（大）帧长

![image-20210830082931094](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830082931094.png)

如图所示：在一条总线上，主机A发送一段比较短的帧给主机D，发送比较短的帧很快就发送完毕了，在还未发送到主机D 的时候，主机C也要发送帧，此时主机C首先进行载波监听，检测到总线上有96比特的时间之后就立即发送帧，还要进行碰撞检测，不过此时是检测不到信号碰撞的，因为主机A发送的帧太短了，主机C误认为总线上有空余的时间从而必定造成信号碰撞，但是信号碰撞产生的结果并不会返回到主机A中，因为主机A早就将帧发送完毕，即使是发送碰撞，主机A也并不会知道发生了碰撞 ，此时发生完碰撞的帧发送到了主机D，主机D将检测出这是一个已经发生了碰撞的帧，随即丢弃该帧。

由上可知：

发送帧的长度不能太短，一般情况下，帧长最小为64字节（512比特），也就是说：发送512比特的时间就是（争用期），最小帧长为64字节，短于64字节的帧都如果检测不到，那么一定是产生了碰撞，被舍弃。

如果发送的数据非常少，那么将进行填充字节，使得该帧至少为64字节的长度。

![image-20210830085838580](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830085838580.png)

---

最大帧长

![image-20210830090031875](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830090031875.png)

由图可知：在不同的帧中，最小数据载荷加上帧首尾部，一一共是64字节，最大的帧长则是帧的首尾部加上最大数据载荷。

---

7.截断二进制指数退避算法

![image-20210830091523197](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830091523197.png)

![image-20210830091714413](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830091714413.png)

![image-20210830091753870](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830091753870.png)



![image-20210830091820996](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830091820996.png)

![image-20210830091911221](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830091911221.png)

在帧接收流程图汇中，只有经过途中最重要的三个步骤，主机才能正确接收到帧。

---

练习题

![image-20210830092124967](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830092124967.png)

![image-20210830092145706](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830092145706.png)

![image-20210830092241581](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830092241581.png)

![image-20210830092320523](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830092320523.png)

***

#### 4.随机接入---无线局域网使用协议：CSMA/CA

简介：

![image-20210830153028544](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210830153028544.png)

![image-20210901144126235](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144126235.png)

 ![image-20210901144403689](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144403689.png)

![image-20210901144506678](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144506678.png)

**![image-20210901144544690](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144544690.png)**

![image-20210901144612996](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144612996.png)

![image-20210901144659722](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144659722.png)

![image-20210901144737682](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144737682.png)

![image-20210901144801946](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144801946.png)

![image-20210901144842738](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144842738.png)

![image-20210901144909703](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144909703.png)

![image-20210901144930443](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144930443.png)

![image-20210901144950266](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901144950266.png)

![image-20210901145013939](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901145013939.png)

![image-20210901145032328](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901145032328.png)

***

### 7.MAC地址、IP地址、以及ARP协议

简介：

![image-20210901145250666](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901145250666.png)

##### mac地址

![image-20210901145950843](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901145950843.png)

在主机发送的帧中，帧必须带有表示符，避免在传输过程中产生的错误，这也就提高了帧的适配率，在帧的首部，会有显示接受主机的地址，而在接收地址的后面就是发送地址的标识符

![](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901150555419.png)

在这里注意：MAC地址也被称为物理地址或者硬件地址，但是它并不属于物理层，它是属于数据链路层， 不要被物理地址俩字给诱惑了。

![image-20210901150912067](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901150912067.png)

![image-20210901151006153](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901151006153.png)

MAC地址是对网络上个接口的唯一标识，并不是对网络上个设备接口的唯一标识。

局域网的地址格式：

![image-20210901151727345](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901151727345.png)

前一段地址格式是由注册管理机构分配的，后48位字节是由网络生产管理厂商自行分配，因此，厂家所自行分配的数据也就成为了全球唯一的数据，而且表示方法有多种，不同的系统表示方法不同。

![image-20210901152700948](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901152700948.png)

在组织唯一的标识符中，第一字节中可以判断MAC的类型

由上图可知：MAC的地址类型有4种，并且具有不同的功能，

![image-20210901152951605](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901152951605.png)

字节发送顺序：

![image-20210901153034127](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901153034127.png)

数值从小到大

---

![image-20210901153610335](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901153610335.png)

主机B构建广播帧，17进制全F就是广播帧的标志，然后在帧的源代码地址中输入自己的标志，再加上一些数据，帧数据帧尾部，就构建成了一个完整的帧，此时发送出去，其他主机就进行接收判断就可以了。

单播MAC的介绍：

主机A和C 都会收到该广播帧，发现该帧首部中的地址字段内容是广播地址，就知道该帧是广播帧，并接受该帧，并将该帧交给上层处理，这就是单播MAC的介绍![image-20210901154147122](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901154147122.png)

---

多播地址的介绍：

![image-20210901154631325](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901154631325.png)

![image-20210901154647351](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901154647351.png)

![image-20210901155200593](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901155200593.png)

主机A构建多播地址发送在总线上，主机B 和主机C 和 主机D 都能接受到主机A所发送的多播地址，

![image-20210901155449218](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901155449218.png)

各主机接受到多播地址后进行提交数据给上层，交由上层处理，由图可知：主机B和C 之间都有与主机A相应的多播地址，所以主机B 和主机C 都能接收并且应用该帧，主机D中不具备接收条件，所以主机D 会将该帧丢弃。

注意：

![image-20210901155916575](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901155916575.png)

---

![image-20210901160011638](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901160011638.png)

随机MAC地址，可以根据MAC地址来进行对个人的跟踪。

***

##### IP地址

属于网络层范畴。本节课主要介绍IP地址的作用。

![image-20210901163335201](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210901163335201.png)

由图可知：IP地址指的是：因特网上的主机和路由器所使用的地址，用于标识两部分的信息，而图中介绍了三个设备的IP地址，是由十进制数表示的，黄色部分是一样的，原因是:接入的是同一个网络，所以显示的网络的IP地址是一样的。而后的蓝色数字表示的是各个设备的IP地址，这是不同的。

![image-20210902083107213](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902083107213.png)

---



![image-20210902083347775](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902083347775.png)

由图可知：在网络体系结构中，IP地址是属于网络层的，在网络层进行包装，包装完了以后向下进行乎传送，数据链路层不需要懂网络层传输下来的帧的意思，只需要在帧上添加首部和尾部，其中MAC地址添加在帧的首部，之后向下传输，物理层将接收到的帧看作是比特流，以便将帧比作比特流的方式传输给接收方。

---

![image-20210902084440415](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902084440415.png)

注意：路由器只有三层结构，只能到达网络层 。

由此在图中就只要看网络层的协议即可，在网络层中，IP地址中，源地址应是发送方的IP地址，而目的地址应是接收方的地址，所以在此传送过程中IP地址是不会发生变化的，一直是图中所示，在链路层中，要进行MAC地址的包装，MAC地址与IP地址不同的是，随结点的变化而变化，只不过最开始的源地址是发送方的地址，最终的目的地址是接收方的地址。在传输的过程中，MAC地址是会发生改变的。

![image-20210902085235557](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902085235557.png)

---

练习题：

![image-20210902085700156](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902085700156.png)

***

##### ARP协议

![image-20210902090144854](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902090144854.png)

当主机B要发像主机C发送数据时，但是不知道主机C 的MAC 地址，所以将要发送ARP请求报文，ARP请求报文被封装在MAC帧中 ，也就是在数据连路层中，此时主机A和主机C 都将收到此报文，在该发送的报文中，请求报文是有标准格式的，在标准格式中，基本内容是：我的MAC源地址是，，，请求的报文地址是，，，。所以在这里，主机A和主机C接收到报文时会进行判断，如果发现是与自己的MAC地址相关，那么就会回应一个信号，并且将MAC地址包装在其中。这样主机B就能知道将数据发送到哪了。

![image-20210902091206327](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902091206327.png)

![image-20210902091323201](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902091323201.png)

![image-20210902091404239](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902091404239.png)

由图可知：ARP协议是不能跨网络使用的，所以在该多个网络中，是不可以使用ARP协议的。

![image-20210902091534471](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902091534471.png)

***

## 第四章

### 1.集线器与交换机的区别

 ![image-20210902094414720](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902094414720.png)

早期的以太网，并不可靠，所以就被淘汰了。

![image-20210902094527948](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902094527948.png)

这是升级之后的集线器，有几个特点注意一下：

1.集线器在逻辑上还是总线型的，所以只要发送一个信号，子主机上都能接受到所有的信息，它不同于交换机，，交换机是发送一个数据时，并不是所有主机都能接收到信息，而是可以特定设置接受的主机

2.集线器只是在物理层工作，只有简单的接口，并不能进行碰撞检测。

3.集线器一般有少量的容错能力，和网络管理功能。

![image-20210902095457389](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902095457389.png)

---

以太网交换机

![image-20210902095538229](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902095538229.png)

在以太网交换机中，首先工作原理在数据链路层。（包括物理层)，能同时连接多个接口，主要时通过帧的交换进行工作，可以在接收到帧时，对其MAC地址进行判断，将其发送到目的地址中。

---

![](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902100321223.png)

在广播的信号情况下，集线器和交换机的作用是一样的，因为在广播的信号发送中，所有的子机都能接收到信号，并不能看出区别，但是在单播中，要指定特定的主机，这时候交换机的作用就显而易见了，在交换机的作用下就不会产生碰撞，集线器在单播的情况下就容易产生碰撞。 

![image-20210902100737850](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210902100737850.png)

***

### 2.以太网交换机自学习和转发帧的流程

   ![image-20210903084604435](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210903084604435.png)

以太网交换机工作在数据链路层，（同样的也包括物理层 ）

以太网交换机是通过帧交换来进行工作的，在帧交换表中，根据MAC地址来查找进行交换的两个主机。

---

自学习

![image-20210903085156750](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210903085156750.png)

上图所示：

有两台以太网交换机，每一台交换机都链接着3个主机，两台交换机进行互相连接，构成了一个大型的交换机系统。首先，主机A要发送帧给主机B，这里为了方便起见，就先认为各主机都互相知道MAC地址，可以直接进行发送，不用再通过ARP协议进行获取MAC协议。由图所示，主机A发送的帧先进入以太网交换机，交换机内的帧交换表记入主机A的MAC地址，也就是源地址，然后也要记入接口序号，这样不会产生接口错误。

以上的登记过程就称为：交换机的自学习过程。

接下来：

![image-20210903090118854](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210903090118854.png)

主机A的目的地址是，主机B ，所以交换机内部对主机B 的MAC地址进行查找，发现帧交换表中没有主机B 的MAC地址，于是交换机将会进行信号转发，是对所有主机进行信号转发，所以又称为：泛洪，

![image-20210903090731342](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210903090731342.png)

以太网交换机1，再交换机内进行泛洪，当主机B的网卡收到泛洪过来信号时，主机B会对帧进行判断，发现其中有主机B的MAC地址，所以就会知道该帧是发送给自己的，所以就会接收该帧。而主机C的网卡接收到该帧后，发现其中不是自己的MAC地址，就会将该帧丢弃。

![image-20210903091649133](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210903091649133.png)

同样的在4号接口，交换机发送的帧通过4号接口将帧发送给了以太网交换机2中，同样的以太网交换机2对数据进行登记，登记的是源地址，主机A的地址，同样的要进行接口序号登记，然后也要进行 泛洪转发，当所有主机接收到以后，发现都不是自己的MAC地址，于是各主机都将接收到的帧丢弃。

明确转发

![image-20210906074107737](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906074107737.png)

主机B给主机A发送帧，主机B发送的帧中包含了主机A相对应的MAC地址，当当送的帧进入交换机，交换机会进行登记工作 ，这也是交换机的自学习功能，交换机在帧交换表中查找帧，结果发现有主机A的帧，交换机也就知道该帧是明确的发送给主机A的，主机A收到帧后，查询了其MAC地址，发现是和自己是一样的，所以就接收该帧，这也就是明确的转发。而其他的交换机并不会接收到该帧。

E》A

![image-20210906075242096](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906075242096.png)

和B》A是一样的情况。

丢弃帧的情况

![image-20210906075602046](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906075602046.png)

在主机A的接口处连接一个主机G，主机G要将帧发送的给主机，先将发送的帧通过交换机进行登记（这里登记的是源地址，例如主机B发送帧给主机A ，那么登记的源地址就是主机B的MAC地址，然后交换机会对帧进行序号查找，在帧交换表中查到主机A的MAC地址，所以知道如何转发，但是该转发接口和发送接口是同一个，所以交换机不会对其进行转发，也就是主机A不会接收到该帧，这就是交换机的帧丢弃。

---

到期自动删除：

![image-20210906080151362](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906080151362.png)

主机之间的的帧交换是有时间记录的，而这些时间记录到期就自动删除，为什么会自动删除呢？

答：这是因为交换机与个接口的对应关系并不是永久性的，例如：如果主机坏了或者更换网卡，相应的MAC地址就会发生改变，所以MAC地址很容易就发生改变，这也就不是永久性的对应关系。就像是ARP协议中IP地址与MAC地址相对应的关系，也并不是永久性的。

---

习题：

![image-20210906080939498](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906080939498.png)

分析：

**![image-20210906081602776](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906081602776.png)**

注意点：

注意每一个转发的过程是明确转发还是泛洪，泛洪的话每一个交换机中都会记录源地址，而明确转发的话只会有相关的交换机记录对应的主机MAC地址。

---

![image-20210906082625682](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906082625682.png)

分析：

![image-20210906082916368](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906082916368.png)

以太网交换机工作在数据链路层 ，其中也包括物理层，转发的PDU通常也称为帧，所以在帧交换表中查找帧的范围，然后通过该接口转发帧，MAC地址通常又称为硬件地址和物理地址，并不要被物理地址所迷惑，并不属于物理层的范围，而是属于数据链路层的范围。

![image-20210906083656637](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906083656637.png)

![image-20210906084220948](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906084220948.png)

转发端口

***

总结：

![image-20210906084258317](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906084258317.png)

***

### 3.以太网交换机的生成树协议STP

![image-20210906183903489](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906183903489.png)

冗余链路会形成网络环路，这也是冗余链路所带来的负面效应，

第一：广播风暴，大量消耗网络资源，使得网络无法正常转发其他数据帧；

第二：主机收到重复的广播帧，大量消耗主机资源。

第三：交换机的帧交换表震荡（漂移）

图中所示的MAC地址登记表中，会不断将错误的地址进行删除，也会不断地登记新的MAC地址。

![image-20210906184841580](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906184841580.png)

。

***

### 4.虚拟网络VLAN概述

![image-20210906185832118](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906185832118.png)

以太网交换机工作原理在数据链路层（也包括物理层）

使用一个或多个以太网交换机互连起来地交换式以太网，其所有的站点都属于同一个广播域。

随着交换式以太网规模地扩大，广播域相应地扩大。

巨大的广播域会带来很多弊端：广播风暴，难以管理和维护，潜在的安全问题。

---

![image-20210906190321671](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906190321671.png)

广播风暴：

当一台主机要发送帧给另一台主机，此时主机间互相都不知道MAC地址，此时 需要发现送ARP请求协议进行获取相应的MAC地址，但是这是由多个主机形成地广播域，一台主机发送ARP请求协议，其余的主机都可以接收到，这就是所谓地广播风暴。弊端：广播风暴会浪费网络资源和各主机的CPU资源。

因此，除非应用必须使用广播，否则网络中的主机尽量不使用广播。

![image-20210906191548270](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906191548270.png)

---

分割广播域的方法：

![image-20210906191712232](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906191712232.png)

使用路由器，路由器可以将广播域分隔开，形成一个较小的广播域，从而减轻广播风暴的影响。但是路由器的成本是很高的，在一个局域网中，都使用路由器来进行分割广播域是不太现实的，所以在此，虚拟局域网VLAN技术应运而生。

![image-20210906192325013](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906192325013.png)

虚拟局域网:将设备依据相同需求的组别进行划分，具有相同需求的会被划分在一起，这样就可以将一个大的广播域划分成一个小的光广播域。使得形式不同的功能。

***

### 5.虚拟局域网VLAN的实现机制

1：虚拟局域网VLAN技术是在交换机的基础上实现的，在此就需要交换机具有某些功能。

2：交换机需要具备的功能：

第一：能够处理带有VLAN标记的帧，也就是如下帧。

![image-20210906193111693](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906193111693.png)

第二：交换机的各端口可以支持不同的端口类型，不同类型的端口对帧具有不同的处理方式。

![image-20210906193425517](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906193425517.png)

---

![image-20210906193609848](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906193609848.png)

注意：

1，虚拟局域网VLAN具有4个字节，一个字节为8比特，在VLAN中，最后的12比特中标识了以太网帧属于哪一个VLAN，简称为：VID。VLAN标识符：VID。

2.VID具有一定的有效取值范围，有效取值范围为：1~4094

3.802.1Q帧是由交换机来处理的，而不是主机来处理的。

4：打标签：当交换机接收到普通的以太网帧时，会将其插入4字节的VLAN标记转变为802.1Q帧

5：去标签：当交换机转发802.1Q时，可能会删除其4字节VLAN标记转变为普通的以太网帧。

---

![image-20210906194926101](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906194926101.png)

注意：

1：介绍的交换机类型有3种，其中思科交换机没有 Hybird 该端口。

2：本例中，以华为的交换机为例

---



Access端口

![image-20210906195945557](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906195945557.png)

接下来介绍主机A发送广播帧的情况：

![image-20210906200704438](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906200704438.png)

主机A要进行帧的转发，主机A发送的帧通过端口1进入到交换机，因为这是VLAN2，端口的PVID值也是2，刚开始该帧是未 被标签的，又因为该端口是Assess,所以将会对该帧进行标记，该帧的VID是2，在来看主机B ，因为字段中VID和端口的PVID的取值是相等的，所以在主机B中，将会去标签进行转发，因为主机A和主机B同属于一个广播域，所以主机C和主机D将不会受到影响。

再来看主机C发送的情况：

![image-20210906202043663](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906202043663.png)

主机C进行以太网帧的发送，发送到交换机内，此时的虚拟局域网是3，也就是VLAN值为 3，所以在该广播下的PVID是3，由于该端口是Access，会对未被标记的帧进行打标签，该标记的VID的值为3，在交换机中查找，发现主机4中的PVID的值为3，与之对应，所以，有主机4对该标记完了的帧进行去标签转发。

---

Trunk端口

![image-20210906204638484](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906204638484.png)

注意：

1：Trunk端口一般用于交换机之间或交换机与路由器之间的互连。

2：Trunk端口可以设置属于多个VLAN

3：用户可以自行设置Trunk的端口PVID的值，默认情况的PVID值为1。

4：端口发送的处理方法：VID=PVID，去标签再转发

​                                          VID！=PVID，直接转发

5：Trunk端口接收的处理方法：根据接收帧的端口的PVID给帧进行 打标签 。即插入4个字节的VLAN标记字段，字段中的VID取值与端口的PVID 取值相等。

6：接收已经打完标记的帧

---

![image-20210906210806820](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906210806820.png)

对主机A发送广播帧进行分析：

主机A发送的帧，通过端口1 进入交换机，主机A的虚拟局域网是VLAN1，所以相连接的端口PVID的取值为1，因为主机与交换机相连接的端口是Access端口，所以会在交换机内对未标记的帧进行打标签，而此时的帧的VID的取值为1，所以在交换机中，端口2的PVID的值与帧的VID的取值相同，还有两个交换机相互连接的端口5的取值PVID也是1，所以在交换机1中，端口2会对帧进行去标签转发，而在端口5中，会对帧进行去标签再转发。由此转发进入交换机2，交换机2会对未打标签的帧进行打标签，由于端口5的PVID的值为1，所以在进行打标签的环节中，标签的VLAN标签字段的 VID值也是1，又因为交换机2中，端口1和2的PVID的值都是1，所以帧在交换机2中的端口1和2中进行去标签转发。

---

例题：

![image-20210906211010892](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210906211010892.png)

![image-20210907080558542](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907080558542.png)

答案一一对应

---

介绍一下化为独有的：Hybrid端口

![image-20210907081504082](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907081504082.png)

不同于以上两个端口类型，华为这个端口类型结合了另外两个的优点，使得这两个端口的优点都整合到一起了，对于操作来说，使其更加简单。

---

总结：

![image-20210907081925444](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907081925444.png)

***

## 第五章

### 1.网络层的概述

![image-20210907082841625](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907082841625.png)

要实现网络层的问题，需要解决以上几个问题。

![image-20210907082811524](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907082811524.png)

***

### 2.网络层提供的两者服务

![image-20210907084224309](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907084224309.png)

虚电路服务：相当于模拟的电路，实际上是不存在的，并不像电话线那样真是存在，这是个虚拟的线路。而要进行可靠通信，那么就需要用户主机来进行保证，因为用户主机才是真正的可靠传输。

![image-20210907084807420](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907084807420.png)



总结：

![image-20210907084902804](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907084902804.png)

***

### 3.IPV4地址的概述

![image-20210907085249087](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907085249087.png)

![image-20210907085234533](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907085234533.png)

![image-20210907085308333](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907085308333.png)

![image-20210907085439397](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907085439397.png)

![image-20210907085837512](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907085837512.png)

以上是二进制转十进制。

---

接下来是十进制转二进制

![image-20210907090129020](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907090129020.png)

一般只要熟记8位二进制中的各个位置的权值，也就是每个位置的基础数值，128，64，32，16，8，4，2，1，记住这些就可以利用凑值的方法来进行简单的计算

***

4.分类编址的IPV4地址

A类地址：![image-20210907173511868](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907173511868.png)

A类网络地址：最后的位数都取值为零，前7位为01111110，这样的话，即是A类地址默认的地址了。

B类地址：

![image-20210907174134567](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907174134567.png)

最小网络号，也指的是第一个可以被指派的网络号。

C类地址:

![image-20210907174647465](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907174647465.png)

D类地址：无

E类地址：无



![image-20210907174829292](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907174829292.png)

---

![image-20210907174953828](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907174953828.png)



![image-20210907175014237](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907175014237.png)

---

![image-20210907175321396](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210907175321396.png)

***

### 4.划分子网的IPV4地址

![image-20210908105843015](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908105843015.png)



一个单位要使用网络，会在因特网上申请IP地址，因特网根据需求，进行IP地址的分配，而分配的一种类型的网络，肯定会有IP地址的剩余，此时剩余的IP地址就只能使用一个网络，不能进行的不同网络的使用 ，因为未分配网络地址的话，就实行统一管理，所有剩余的IP地址都进行统一的网络管理。

---

![](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908110531035.png)

图中所示:不同的网络设置不同的网络编号，这就需要知道如何判断不同的网络。此时就涉及到一个问题，计算机如何知道哪些部分是子网。

![image-20210908111108232](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908111108232.png)

图中就是子码在显示中的一些技巧。

---

子网划分：

![image-20210908111836138](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908111836138.png)



![image-20210908111916051](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908111916051.png)



---

练习题：

![image-20210908112000108](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908112000108.png)



![image-20210908112120243](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908112120243.png)

---

默认子网掩码

![image-20210908112311818](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908112311818.png)



总结：黄色部分为重点

![image-20210908112347523](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908112347523.png)

***

### 5.无分类编址的IP地址

![image-20210908151657484](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908151657484.png)

---

CIDR

![image-20210908151823211](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908151823211.png)

---

无分类编码地址

![image-20210908152126055](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908152126055.png)

练习

![image-20210908152211715](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908152211715.png)

---

路由聚合

![image-20210908152440039](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908152440039.png)

---

![image-20210908153107564](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908153107564.png)

![image-20210908153225536](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908153225536.png)

***

总结：

![image-20210908153259066](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908153259066.png)

***

###  6.IPV4地址的应用规划

![image-20210908154010343](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908154010343.png)

![image-20210908154047329](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908154047329.png)

 ![image-20210908154157304](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908154157304.png)

注意：图中子网掩码使用十进制数，注意其中的转换。

![image-20210908154520703](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908154520703.png)

![image-20210908154637182](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908154637182.png)

---

变长的子网掩码VLSM

![image-20210908154855803](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908154855803.png)

![image-20210908155056027](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908155056027.png)

![image-20210908155419162](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908155419162.png)

练习题

![image-20210908155453164](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908155453164.png)

---

总结：

![image-20210908155525258](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908155525258.png)

***

### 7.IP数据报的发送和转发过程

![image-20210908160358723](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908160358723.png)



![image-20210908161334373](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908161334373.png)

我们知道，同一个网络中的主机可以直接通信，这个过程称为直接交付

不同网络之间的的通信需要通过路由器来进行中转，这属于简介交付

此时问题来了，源主机如何判断目的主机与自己在同一个网络中呢？

![image-20210908161224822](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908161224822.png)

举例：主机C要将数据发送给主机F，主机C将自己的IP地址和子网掩码相与。相与之后就可以得到主机C的网络地址，

![image-20210908162352067](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908162352067.png)

既然主机C要给主机F发送IP数据报，那么主机C肯定知道主机F的IP地址。

主机c将主机f的IP地址与自己的子网掩码相与，就可以得到目的网络地址。

![image-20210908162813406](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908162813406.png)

得到目的地址后，与自己的网络地址相对比，发现不同就可以得出主机C与主机F不在同一个网络中。

既然不在同一个网络，所以他们之间的通信属于间接交付，需要将IP数据报先传输给路由器，再由路由器传送给目的主机。

此时问题又来了，主机C怎么知道将IP数据报交给那个路由器进行转发呢？

实际上，用户为了让本网络上的主机能和其他网络上的主机进行通信，就必须给其指定本网络中的一个路由器，由该路由器帮忙进行转发。所指定的路由器也被称为默认网关。

![image-20210908163810811](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908163810811.png)

对于本例：我们可以指定路由器的0号接口指定给该接口所直连网络中的各个主机作为默认网关，同理路由器R的1号接口也可以作为其所直连网络中的各个主机的默认网关。

![image-20210908164117086](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908164117086.png)

这样，当两个不同网络中的主机要进行通信时，可以将IP数据报先转发给默认网关，再由默认网关进行转发给目的主机。

---

举例：主机A发送IP数据报给主机D

![image-20210908164525431](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908164525431.png)

路由器对接受到的IP数据报进行判断，完成 判断后就可以进行转发了。

![image-20210908165057986](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908165057986.png)

接下来就要进行查表转发了。

![image-20210908165329098](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908165329098.png)

ji而下来，路由器根据IP地址在自己的路由表中，查找自己的路由条目。

![image-20210908165501996](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908165501996.png)

将目的地址与路由条目中的地址掩码相与得到目的网络地址，

![image-20210908165557624](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908165557624.png)

该相与得到的目的网络地址与路由条目表中的地址不同，则该条地址作废。再检查下一条路由条目。

![image-20210908165844927](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908165844927.png)

发现该路由条目相同，则就是这条路由条目地址，则按照它的下一条指示进行操作。

![image-20210908170036944](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908170036944.png)

下一跳指示：从接口1转发该IP数据报。这样主机D就可以接收到主机A发送的IP数据报了

以上示例是最简单的最基本的流程原理。

---

情况2：

假设主机A给本网络上的各设备发送了一个广播IP数据报。

![image-20210908222812572](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908222812572.png)

主机A会进行数据报的发送，但是发送的广播数据报发送到路由器中，路由器并不会进行数据报的转发，此时可以得出，路由器是隔离广播域的。这是很有必要的，因为网络中的数据报十分的多，要是路由器都对接受到的数据报进行转发，那么就会造成广播风暴，造成网络资源浪费

同理，主机A给另一个主机发送数据报，观察其目的地址，主机A将数据发送给路由器，路由器进行接收，主机A希望路由器进行数据转发，但是路由器检测到这是一个广播数据报，并不会对其进行数据转发

![image-20210908223847926](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908223847926.png)

---

练习题：

![image-20210908223943990](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908223943990.png)

---

![image-20210908224051988](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908224051988.png)

---

![image-20210908224224783](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908224224783.png)

---

![image-20210908224254610](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908224254610.png)

***

## 第六章

### 1.静态路由配置及其可能产生的路由环路问题

![image-20210908224730237](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908224730237.png)

---

静态路由配置：

![image-20210908224916025](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908224916025.png)

R1是路由器，默认的成为了默认网关，将接收到的数据进行转发，因为主机直接与路由器相连接，所以R1查找路由表，可以进行直接转发，这属于  直接交付。这条自动得出的路由条目的类型属于直连路由。

![image-20210908225424235](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908225424235.png)

![image-20210908225631108](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908225631108.png)

由上图可知：当与R1直连的主机想要发送数据给与R2直连的主机时，此时已经是跨网络了，由此看R1的路由表，目的网络是R2那边的网络地址，下一跳（下一跳就是下一个命令）就是R2的接口0的地址，因为R1这边的主机想要跨网络发送数据，就必须先将数据发送到路由器，再由路由器进行转发数据。此时的类型为静态，这就是静态路由的由来。

---

默认路由：

![image-20210908231004940](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908231004940.png)

当R2接入了一个因特网，因特网中具有大量的网络，此时与R1直连的主机想要发送数据给因特网，首先，要将数据发送给R2路由器，再由路由器进行数据转发，将数据转发给因特网，但是，这时存在一个问题，因特网中存在着太多的网络，如果要进行发送数据报给因特网中的某一个网络，那么就要进行地址配置，进行人工配置的话，工程量太大了，所以是不可取的，这时有一个比较方便的地址，就是默认地址，除了已经进行配置的网络，其他的网络都使用这个默认的地址，简称：默认路由。

---

特定主机概念：

我们可以给路由器添加针对某个主机的特定主机路由条目， 一般用于网络管理人员对网络管理进行测试。另外，在需要考虑安全问题时，也可以使用特定路由。

![image-20210908232625610](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908232625610.png)

假设在R2的直连主机上又连接了一台主机，并且该主机进行了特定的配置，目的网络是该主机的IP地址，下一跳是R2的接口0的地址。此时的类型也是静态的。因为人工配置的网络是静态的。由此可以看到，该特定的主机路由配置，目的网络地址很长，各方面的数据都长，组成的数据是最长的 ，由此得出结论：网络前缀越长，路由越具体，网络前缀越短，路由越模糊，默认路由是最模糊的。因此，在发送数据时，当有多个选择可以选择时，就要选择那个前缀最长的。

----

静态路由配置错误可能导致的路由环路问题：

![image-20210908234344865](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210908234344865.png)

观察各路由的路由表，来看R2的路由表，先是进行转发给R1的接口0，第二次是转发给R1的接口1，然后看第三次，假如我们配置出现了问题，本来要转发给R1的地址，在下一跳中出现错误，下一跳的配置成了R3的接口0，所以在进行转发的过程中，R2对数据进行转，R3接收到数据以后，查找自身的路由表，发现有相同的目的网络地址，于是进行该目的网络地址的下一跳，于是又发送回了R2，然后R2进行自身的识别，又将数据转发给了R3，由此造成了循环。

为了不使错误循环一直占用着资源，在IP数据首部设有生存时间TTL字段，其工作原理是：当IP数据报进入路由器后，TTL的字段的值减1，若TTL的值不等于0，则被路由器进行转发，否则被丢弃。

---

聚合了不同的网络可能导致的路由环路问题：

![image-20210909080255540](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909080255540.png)

这里涉及聚合了不存在的网络导致出现错误。

由图可知：R1要将数据进行发送给R2，查找路由表，发现了R2接口的地址，所以进行数据转发，数据转发至R2，R2进行查找路由表，发现其中又有R1接口1的地址，然后有进行数据转发，转回至R1，由两个网络的地址相与，就得到了新的网络地址，本就不存在的地址，此时的路由表中不存在该地址，于是在路由表中新建一个地址，俗称，黑洞地址。

![image-20210909081417653](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909081417653.png)

黑洞路由的下一跳是null0 这时路由器的虚拟接口。IP数据报进入它以后就有去无回了，也就是路由器丢弃了该IP数据报，并不是对该数据报进行转发。

![image-20210909082119978](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909082119978.png)

假如R2要将数据发送到该不存在的网络中，R2进行路由表查找，发现有两条该地址可以到达该不存在的网络，根据前缀长的原则，选择了黑洞这条地址，于是通过黑洞这条地址进行了数据转发，所以也就造成了数据丢失。

---

网络故障导致的路由环路问题:

![image-20210909082816006](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909082816006.png)

假设一开始，R1 和R2 的路由表都正常，并且每个网络的地址都有，此时出现了网络问题，R1这边黄色部分的网络出现了问题，R1路由表中所对应的目的网络地址消失，此时，R2要进行数据转发给该网络，在R2路由表中查找目的地址，会将数据转发至R1的接口1处，然后在R1中，路由表中查不到相应的网络地址，于是进行默认地址的转发，观察默认地址，又将数据转发给了R2中的接口0，此时就形成了一个环形网络的循环。

如何解决该问题：

在R1路由表中添加一个黑洞地址，这样每次R2想要转发数据给该网络时，R1就会直接进行数据转发，该数据进行黑洞，就无法返回了，所以也就不会造成环形网络的形成。

假设一段时间后，该网络又恢复了，那么 R1就会将黑洞网络设置为失效的状态。自动就失效了。

假设该网络又出现了故障，那么此时R1的路由条目中该网络的路由条目会消失，此时原来的黑洞路由又自动启用了。

***

总结：

![image-20210909084809323](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909084809323.png)

***

### 2.路由选择协议的概述

![image-20210909093948695](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909093948695.png)

静态路由：

由人工 配置的网络路由，默认路由，它特定主机路由，黑洞路由等。适用于小规模网络。

动态路由：

路由器通过路由选择协议自动获取路由信息。适用于大规模网络。

---

![image-20210909151716762](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909151716762.png)



![image-20210909151820539](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909151820539.png)

路由器之间的路由选择称为：域间路由选择

路由器内部的路由选择称为：域间路由选择

域间路由使用的是：外部网关协议EGP，这只是协议的大体名称，并不是具体的协议。

域内路由使用的是：内部网关协议IGP，这只是协议的大体名称，并不是具体协议。

网关 ：这个名词是因为早期使用的名称，现在使用的是：路由器名称 ,所以外部网关协议EGP也可以称为外部路由协议ERP，内部网关协议EGP也可以称为内部网关协议ERP。

![image-20210909152629417](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909152629417.png)

---

![image-20210909152807048](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909152807048.png)

路路由器的基本结构：

![image-20210909153235396](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909153235396.png)

在路由器的网络协议中，最多只能达到网络层，所以在图中显示的最高层只有网络层。图中介绍了：输入缓冲区，和输出缓冲区。输入缓冲区：用来存放还未处理的数据，输出缓冲区：存放已经完成的但是还未发送出去的数据。

***

总结：

![image-20210909153907352](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909153907352.png)

***

### 3.路由信息协议RIP的而基本工作原理

![image-20210909194218014](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909194218014.png)

RIP协议是在内部路由网关中最早使用最广泛的协议。这里有了距离向量的概念

距离概念:

在直连网络中，距离的定义为1

在非直连网络中，距离的 =数值等于所包含的路由器数量＋1，例如：R3到N2，其中有一个路由器R2，所以它之间的距离为1+1=2。

![image-20210909194902799](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909194902799.png)

在RIP协议中，认为好的路由就是短的路由，也就是一段链路中，包含的路由器越少就越好，尽管这条链路中的带宽更小。

---

RIP工作的基本原理

![image-20210909195355565](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909195355565.png)

只有相邻的路由器之间才能进行信息交换，在周期性的时间内交换自己的路由表。用来更新信息数据。

---

RIP基本工作过程

![image-20210909195832984](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909195832984.png)

由图可知：

每个路由器之间相互都为相邻路由器可以进行数据交换。

收敛：当路由器不断地交换数据，每个路由器都知道各个路由器到达自身路由器的最短距离和下一跳，这就称之为收敛。

---



路由条目更新规则

![image-20210909200636152](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909200636152.png)

一切的更新都是以更好的选择进行更新，更新只会越来越好，所以在相同的条件下选择最好的那个。当然在选择更新时会有更差的选择，所以当有更差的选择时就不进行更新了。

![image-20210909201155206](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909201155206.png)

---



练习题：

![image-20210909201415126](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909201415126.png)

在RIP协议中，距离16就表明该距离的网络不可达。因此，R2无法到达NET1，R1也无法通过R2到达NET1.

---

RIP中坏消息传的慢的问题

![image-20210909201942397](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909201942397.png)

假设一开始，N1网络就不可达，则N1网络就会被标注距离为16，表示的是该网络不可达，但是R2并不知道N1已经出现问题，所以R2可以继续发送数据给N1，但是是先发送数据给R1，再由R1进行数据转发，本来R1已经知道N1网络出现了问题，但是被R2发送的数据给迷惑了，所以R1会继续发送数据给R2，这里就会造成了数据循环。

解决此问题的方法有：

1，限制最大路径的距离为15，（16表示距离不可达）

2.当路由表发生变化时，就应立即发送数据给周围的路由器，提前进行数据更新。

3.让路由器接收某特定的信息接口，不要让同一路由信息再通过该接口进行反向发送数据。

---

练习题

![image-20210909203436715](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909203436715.png)

---

总结：

![image-20210909203511750](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210909203511750.png)

***

### 4.开放最短路径优先OSPF的基基本工作原理

![image-20210910100806664](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910100806664.png)

链路状态：指的是本路由器与哪些路由器相邻，这个称为链路状态。

相应的链路代价，代价指的是：费用，距离，时延，带宽，等等，都是由管理人员控制。

![image-20210910101717162](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910101717162.png)

由图可知：路由器之间发送Hello分组，如果超过40秒该分组未到达邻居路由器，那么就认为该邻居路由器不可达。

---

![image-20210910102443735](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910102443735.png)

链路状态数据库LSDB，用于存储LSA。

通过各路由器泛洪发送封装有自己LSA的LSU分组，各路由器的LADB最终将达到一致。

---

![image-20210910102917587](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910102917587.png)

OSPF有一下五种分组类型

![image-20210910103156174](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910103156174.png)

---

OSPF的基本工作过程

![image-20210910230454617](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910230454617.png)

建立邻居关系

‘先是两个路由器进行互相发送问候分组，然后发送数据库分组，因为是R1是先发送数据给R2，所以R1要发送请求链路状态更新分组，而R2进行链路分组接收，接收完成以后会进行链路状态的更新，然后R1发送链路状态确认分组。在多次发送以后，两边的链路状态会达到同步，在周期性的时间下，路由器会进行更新信息的发送，确认。

---

![image-20210910231427868](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910231427868.png)

多点邻居关系的建立

---

![image-20210910231750440](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910231750440.png)

OSPF把一个自治系统再划分为若干个更小的范围。每个不同的区域都会有一个主干路由器，再路由器的边缘，会有一个边界路由器边界路由器的作用是：连接主干路由器的同时连接不同范围的路由器，将不同范围的路由器进行整体的连接，从而形成一个更大的范围，例如图中：R3将绿色的范围和红色的范围连接起来，R3要向红色区域发送绿色区域的数据，同时也要向绿色区域发送红色区域的数据，进行一个不同范围的数据互通。

主干区域：图中红色区域是主干区域，主管区域至少有两个路由器，主干区域的R6也称之为：至其他自治系统，因为要进行其他系统的连接。

---

总结：

![image-20210910232820597](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910232820597.png)

***

### 5.边界网关协议BGP的基本工作原理

![image-20210910233544694](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210910233544694.png)

内部网关协议用于自治系统内部的路由选择，典型的协议有：RIP ,OSPF

---

![image-20210911084105102](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911084105102.png)

AS4到达路径有很多，因为到达目的地址的路径选择是不同的，所以可以有很多条不同的选择。

---

![image-20210911084725323](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911084725323.png)

进行路由器的选择，并一定要进行最佳选择，而是网络管理员根根据不同的条件进行不同的选择，依据上图可知，如果是国内的站点要进行数据发送，那么它就不应该经过国外的站点，这也是出于安全考虑，，右图可知，每一个路由中，不一定都会让你通过，这也使得本来只要最短路线的距离变得更长了。

---

边界网关协议的配置和使用

![image-20210911085748843](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911085748843.png)

主干在每一个自治系统中，至少有两个路由器进行工作，其中一个就是用来作为BGP发言人的

工作原理

：BGP工作时，首先要建立TCP连接，再此TCP连接上 进行BGP的会话，利用BGP进行信息交换。

使用TCP交换路由信息的两个BGP发言人，互称为对方的邻站，或对等。

BGP发言人除了运行BGP外，还必须运行自己所在自治系统所使用的内部网关协议IGP，例如OSPF,  RIP。

---

![image-20210911090640419](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911090640419.png)

根据又图信息，这时一个BGP发言人根据所采用的策略从收到的路由信息中找出到达各自治系统的较好的路由，也就是构造树形结构，不存在回路的自治系统的连通图，由此可以看出，每个BGP发言人通过路由选择构造的自治系统连接图，都是树状图，所以也就代表了不存在回路的自治系统连通图。

---

 ![image-20210911091507498](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911091507498.png)

BGP适用于多级结构的因特网，但是重点依然是树状结构，例如：主干网AS1中要发送数据到N1,2,3,4,5,6,7.可以通过AS2或者AS3进行数据发送，但是每次只能进行一个中间BGP发言人，这也就是不能进行数据连通使用。

---

BGP中规定的四种报文

![image-20210911092145072](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911092145072.png)

---

练习题

![image-20210911092345809](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911092345809.png)

R1和R2处于不同的两个系统，所以进行数据交换的前提就是建立TCP连接，然后进行报文数据传输，重点是两个不同的自治系统使用的是边界网关协议BGP 

---

![image-20210911092732247](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911092732247.png)

---

总结：

![image-20210911092756853](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911092756853.png)



***

### 6.IPV4数据报的首部格式

![image-20210911093109563](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911093109563.png)

简单的介绍数据报格式

每个小方格就是一个字段或者称之为域，每个字段或者某些字段的组合用来表达IP协议的相关功能。

---

简单介绍字段的功能：

![image-20210911093545081](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911093545081.png)

![image-20210911171145857](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911171145857.png)

![image-20210911171252025](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911171252025.png)

![image-20210911171351281](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911171351281.png)

填充字节：

该字段的都是以0来进行填充，首先，首部长度时为4字节的，而整个数据的长度为4的整数倍，固定部分又20字节，可变部分有40字节，所以很多情况下，IP数据报中的字节数并不是4的整数倍，此时就发挥了填充字节的作用，用0来进行填充，使其字节数为4的整数倍。

---

![image-20210911172536787](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911172536787.png)

区分服务字段，在以前的标准中：叫做服务类型，但是只有在使用区分服务时该字段才起作用。

---

![image-20210911173004871](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911173004871.png)

计算：

首先这里使用的是二进制，首部占用4个比特，以字节作为单位，在计算式，二进制转化为十进制，在进行乘4，最终得到字节数，而区分服务段标志的是总长度，如果要进行数据载荷的长度计算，那么用总的长度减去首部字节长度即可。

---

![image-20210911173915554](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911173915554.png)

标识，标志，片偏移，这三个共同作用于IP数据报分片

分片：

IPV4数据报是有最大长的的，最大长度为1500字节，当IPV4数据报超过这个字节，进无法进行封装成帧，也就意味着无法进行数据传送，此时就要进行分片，将其分为好几份数据进行封装，这样就是原来超过1500字节的长度的IP数据报，被分成好几份短的数据，进行封装，这样会有好几个帧，也能进行数据传送。

![image-20210911175602442](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210911175602442.png)

---

IP数据报如何进行分片

![image-20210912161817488](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912161817488.png)

对IP数据报进行分片：上图可知：IPV4的数据报长度为3800字节，但是要进行数据传输的话只能是1500字节的数据，所以要进行数据分片，上图可知将数据报分成了3个片段。

但是在传输的过程中，要在数据报的前面添加上首部，根据首部的指导完成接下来的操作。对表格进行分析，原始数据报的长度为3800字节加上固定首部的字节为20字节，分片1是1400字节，分片2是1400字节，分片3是1000字节。

关键：MF：0：表示这是最后一个分片，1：表示后边还有分片

​           DF：0：表示允许分片，1：表示不允许分片。

片偏移：根据不同分片的长度可以得出片偏移的数据。

![image-20210912163259755](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912163259755.png)

上图所示：分片2可以继续进行分片，然后根据数据进行填写即可

---

![image-20210912163745339](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912163745339.png)

生存时间TTL：数据值相减为0就丢弃，不为零就进行转发。还可以用跳数作为计算单位，将IP数据报首部中该字段的值减去1，若不为零就进行转发，否则就丢弃。

生存时间的作用：

![image-20210912164451587](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912164451587.png)

举例：N1要将数据转发给N2，由图中的路由表所示，R2的路由表出现了错误，在N2转发的下一跳地址错误的称为R1，所以在数据发送的过程中，N1将数据发送给R1，R1再将数据发送给R2，此时在R2中出现的目的地址出现了错误。就会一直导致路由发送的数据在不断地循环中，而此时，生存时间在此就体现出作用了，也就是为了防止出现循环的现象。

---

协议：

![image-20210912165610650](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912165610650.png)

协议存在于首部中，用来标识所发送的数据报是何种类型的，也就是说，接收方可以通过所接受数据报的首部中的协议内容来判断出该数据报是哪种类型的。

例如：首部中协议字段为1，那么这就是ICMP报文。如果为6，那就是TCP报文。

---

首部检验字段

![image-20210912170327132](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912170327132.png)

重点：IP数据报每经过一个路由器，路由器就要重新计算首部检验和，因为每经过一个路由器其中的某些数据就会发生数据变化，所以IP数据报每次经过一个路由器就会重新计算首部检验和。

---

  ![image-20210912170831606](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912170831606.png)

地址字段，用于填写源主机的地址字段，目的主机地址，用于接收目的主机的地址字段。

---

练习题：

![image-20210912171025455](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912171025455.png)

![image-20210912173619766](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912173619766.png)

---

![image-20210912173656072](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912173656072.png)



![image-20210912173827273](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912173827273.png)

![image-20210912174007535](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912174007535.png)



![image-20210912174106569](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912174106569.png)

---

总结：

![image-20210912174151566](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912174151566.png)

***



### 7.网际控制报文协议ICMP

**![image-20210912193438568](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912193438568.png)**

ICMP报文将封装在帧中发送，主机或路由器将ICMP报文用来发送差错报告报文或者询问报文。

---

ICMP差错报文以下5种

1.终点不可达

 ![image-20210912193747154](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912193747154.png)

当主机不能进行数据报交付时，就要向主机发送不可达报文（ICMP)，通知主机知道该报文不可达

---

2.源点抑制

![image-20210912194233476](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912194233476.png)

源点抑制适用范围：当主机或者路由器因繁忙而丢弃数据报时，就会向元点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢。（自我理解：就是在主机或者路由器繁忙时，数据发送不正确，因为在主机或者路由器繁忙时，主机或者路由器会对数据进行丢弃，此时会造成数据的延迟，这时主机或者路由器会将ICMP数据报文发送给源点，也就是通知源点给数据报文发送不正确）

当主机H1要发送数据给R2时，先将数据发送给R1，再通过R1将数据发送给R2，此时R2数据繁忙，不进行数据接收，反而会进行数据丢弃，此时会向源点发送ICMP报文，作用是通知源点该数据报文发送错误。

---

3.时间超过

![image-20210912195735013](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912195735013.png)

分析：时间超过有两种类型

类型一：当路由器收到一个目的地址不是自己的IP数据报，会将其生存时间减去1，也就是生存时间TTL字段的值减去1.若结果不为零，则将该数据报文继续发送出去，如果结果为0，将该IP数据报丢弃，并且将要向源点发送ICMP差错报文。

类型二：在终点规定的时间内不能完全接收应该接收的所有数据报文，此时也会进行ICMP差错数据报文的发送。 

---

4.参数问题

![image-20210912200559726](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912200559726.png)

当主机或者目的主机接收到在传输过程中出现误码的数据报，就会将该数据报进行数据丢弃，并且发送ICMP数据报文给源点。

---

5.改变路由

![image-20210912201118809](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912201118809.png)

路由器将改变路由的报文发送给主机，让主机知道下次应将数据报发送给另外的路由器（可通过更好的路由）

---

以下情况了不应该发送ICMP差错报告报文

![image-20210912201603815](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912201603815.png)

---

练习题

![image-20210912201859663](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912201859663.png)

---



![image-20210912202204958](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912202204958.png)



![image-20210912202408491](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912202408491.png)



![image-20210912202511057](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912202511057.png)

![image-20210912202534650](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912202534650.png)

![image-20210912202741439](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912202741439.png)

跟踪路由的原理：

利用上述的  时间超过  原理：一次发送数据报文给H2，重点在于H1发送的数据报文设置的生存时间TTL的值，因为时间生存值会经过一个路由器就减少1，所以依次发送含有不同生存时间的数据报文，就能推断出源主机到目的主机的距离了。

---

总结：

![image-20210912203223450](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210912203223450.png)

***

### 8.虚拟专用网VPN与网络地址转换NAT

 ![image-20210913082653168](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913082653168.png)

![image-20210913082735143](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913082735143.png)

上图所示就是不用申请的专用地址，也可以成为私有地址。

私有地址：私有地址只能用于内部使用，不能用与因特网使用，也就是说：因特网上的IP数据报的转发对私有地址的目的地址都不进行转发。

---

![image-20210913083517347](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913083517347.png)

举例：部门A要向部门B发送数据，每个部门用的是专用网 ，在发送数据时，部门A先将IP数据封装成帧，这就是内部IP数据报，相当于加密，然后通过该部门的公用网进行数据发送，部门B在公用网络中对该IP数据报进行数据接收，然后通过去除首部，解密，获取IP数据报的源地址和目的地址。

在此，R1和R2之间相当于点对点通路，也成为 IP隧道技术。

![image-20210913084721534](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913084721534.png)

内联网VPN：

同一机构内的不同部门的内部网络所构成的虚拟专用网VPN

外联网VPN：

有时一个机构内需要其他机构的加入，也就是合作伙伴的加入，这样的VPN称为外联网VPN

远程接入VPN：

在外需要办公的使用者进行使用，还有就是学生在家需要进入校园网，此时也需要用到VPN

---

![image-20210913085955108](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913085955108.png)

![image-20210913090414640](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913090414640.png)

上图所示：专用网中需要下载一个NAT软件，使其能够连接上全球IP地址，拥有NAT的路由器也被称为：NAT路由器

注意：在原来发送数据报时，源地址是专用网的地址，目的地址是因特网的地址，也就是全球地址，但是有了NAT进行分配全球地址后，IP数据报的源地址也就改为了全球地址，NAT的作用就是给普通的路由器分配一个临时的全球IP地址。使其专用网也能进行因特网的使用，减轻了IPV4地址即将使用耗尽的压力。

---

![image-20210913091259692](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913091259692.png)

分析：

因特网将数据报进行转发给专用网的主机，一开始，因特网转发的源地址和目的地址都是全球地址，因为先要将IP数据报转发给NAT路由器，再通过NAT路由器进行转发，在NAT路由器中，即接受到因特网发送过来的IP数据报后，查找自己的路由表，通过外网的IP地址来找到相对应的内网IP地址，找到后将IP数据报发送给对应的专用网（私有地址）。

---

问题：NAT路由器具有N个全球IP地址，那么至多只能有N个内网主机能够同时和因特网 上的主机进行通信。如何解决该问题。

![image-20210913092316636](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913092316636.png)

解决方法：

![image-20210913092409206](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913092409206.png)

由于绝大多数的网络应用都是使用运输层协议中的TCP或UDP来传输数据的 ，所以利用运输层的端口号和IP地址一起进行转换。。这样，用一个全球IP地址就可以使多个拥有本地址的主机和因特网上的主机进行通信，这种将端口号和IP地址一起进行转换的 技术叫做：网络地址与端口号转换NAPT。

![image-20210913093028756](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913093028756.png)

---



![image-20210913093305800](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913093305800.png)



![image-20210913093238964](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913093238964.png)

外联网是不可以首先发起通信的，这样会在NATP路由表中查不到所对应的目的地址。

***

## 第七章

### 1.运输层的概述

![image-20210913165224553](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913165224553.png)

在计算机中，真正通信的实体是位于通信两端主机中的进程。这也就是运输层的作用。

注意：运输层的协议又称为端到端协议。

如上图可知：运输层的作用范围是端到端之间，而网络层的作用范围是在网络与网络之间。

---

   从逻辑层面概述:

![image-20210913170121459](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913170121459.png)

在运输层中，AP1234，就像是用户主机中的应用，通过运输层进进行数据传输，在运输层一下的网络体系中并不会向主机提供数据，实际上，运输层会将运输层一下的网络体系隐藏，用户看不见运输层一下的网络体系传输数据。这也就是为什么称之为端到端的运输层 了。

![image-20210913170649360](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913170649360.png)

---

总结：

![image-20210913170704260](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913170704260.png)

***



### 2.运输层端口号、复用与分用的概念

![image-20210913170921883](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913170921883.png)

运输层的作用就是直接为应用进程间的逻辑通信提供服务。

从上图中可以看出，运输层是通过红色线进行数据传输的，但是实际上是经过个网络体系，最终经过多个路由器，到达目的主机，然后经过目的主机的各网络体系将数据传输至运输层 。

---

![image-20210913172207757](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913172207757.png)

注意：

因为操作系统的不同，所以就必须使用统一的方法对TCP/IP体系的应用进行标识。

端口号仅仅是为了标识本计算机应用层中的各进程，在因特网中，不同计算机中的相同端口号是没有联系的，也就是在不同的计算机中即使是一样的端口号，也互不影响。

---

发送方的复用和接收方的分用

![image-20210913173225937](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913173225937.png)

分析过程：

UDP复用：

发送方中应用进程产生的应用报文如果是用UDP协议进行封装，那么该报文就是UDP报文，进行的操作是UDP复用，注意：UDP是用作用户数据报的

TCP复用：

同理，应用报文经过TCP协议封装，就成为了TCP报文，进行的操作是TCP复用，注意：TCP是用作报文段的。

此时，运输层的作用就已经体现完毕了，接下来要进行的是网络层中的作用，网络层将UDP复用的用户数据报和和TCP复用的报文段进行添加IP首部，使其在网络层中成为IP数据报。

IP复用：

IP复用就是将UDP复用的用户数据报和和TCP复用的报文段进行添加IP首部，使其在网络层中成为IP数据报。IP复用根据两种数据报的值不同进行不同的封装。

IP分用：

就是将上一个步骤中IP复用的结果进行分用。IP复用的结果是将UDP用户数据报和TCP报文段进行添加IP首部，使其称为IP数据报，便于在网络层中进行数据转发。而分用的作用就体现在接收方上，将接收到的IP数据报进行分开，分成UDP用户数据报和TCP报文段，然后再进行UDP和TCP的分用，原理和IP分用是一样的，分用时根据两种数据报文的值不同，就可以区别出两种不同的报文。最后发送方的应用报文成功的发送到接收方的运输层中。

---

 常用的端口号![image-20210913180720636](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913180720636.png)

---

![image-20210913200131321](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913200131321.png)

![image-20210913200205708](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913200205708.png)



![image-20210913200334630](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913200334630.png)

  ![image-20210913200528779](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913200528779.png)

![image-20210913200638294](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913200638294.png)

---

总结：

![image-20210913200722990](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913200722990.png)

***

### 3.UDP和TCP的对比

 ![image-20210913200846554](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913200846554.png)

这是之前介绍的两者区别，UDP是用户数据报，TCP是传输控制协议报文段。

---

![image-20210913201207986](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913201207986.png)

UDP用户：

都是用UDP的用户两者可以随时进行通信，不需要任何连接。

TCP用户：

都是使用TCP的用户不能直接进行连接，TCP用户的连接，首先要进行 三报文握手 建立连接，然后才能进行数据传输，数据传输结束之后，要进行 四报文挥手 释放连接，三报文握手，和四报文挥手 都是TCP协议中的连接方式，由此可见：UDP是无连接的数据传输，TCP是面向连接的数据传输，传输数据需要先建立连接。

---

![image-20210913202634953](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913202634953.png)

二者的连接方式区别：

UDP连接：

多个UDP互相连接，可以互相发送信息，其中并不需要建立连接，可以直接进行连接，也就是形成了，单播，多播，广播，的状态。

TCP连接：

由图可知：TCP在进行数据通信前必须要先建立 三报文握手通信连接， ![image-20210913203130074](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913203130074.png)

也就相当于建立了通信链路，二者独立通信，不可以进行其他通信，所以，TCP是独立通信的，仅仅支持单播。

---

**![image-20210913203852539](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913203852539.png)**

用户数据协议报UDP：

![image-20210913204054398](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913204054398.png)

发送方中的应用进程将应用层报文添加上UDP首部，忽略其他层的协议，应用层的传输过程如上图所示，接收方会接收到应用层报文，并将应用层报文中的UDP首部去除，然后将应用层报文发送给接收方。

由此得出：UDP是面向应用报文的。

![image-20210913204630134](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913204630134.png)

TCP传输控制协议：

发送方的TCP，把应用进程交付下来的数据块，仅仅看作是一连串无结构的字节流，TCP并不知道这些待传送的字节流的含义， 仅将他们编号，并存储在自己的发送缓存中，TCP根据发送策略，从发送缓存中提取一定数量的字节构建TCP报文段并发送，

![image-20210913205828970](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913205828970.png)

接收方的TCP，一方面从所接收到的TCP报文段中，取出数据载荷部分并存储在接收缓存中，一方面将接收缓存中的一些字节交付给应用进程，![image-20210913210125896](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913210125896.png)

TCP不保证接收方应用进程所收到的数据快与发送方应用进程所发出的数据块具有对应大小的关系。

例如：

发送方应用进程交给发送方的TCP共10个数据块，但是接收方的数据块可能只用了4个数据块，就把收到的字节流交付给了上层的应用进程，但接收方收到的应用进程必须和发送方应用进程发出的字节流完全一样。

当然，接收方的应用进程必须有能力识别所接收到的字节流，把他还原成有意义的应用层数据。

也就是说:TCP是面向字节流的，这正是TCP实现可靠传输，流量控制，以及拥塞控制的基础。

在此需要说明的是，为了突出重点，上图所示仅仅是一个方向的数据传输，实际上TCP是可以同时进行数据流的发送和接收，也就是全双工通信。

---

 ![image-20210913211554579](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913211554579.png)

UDP用户数据报协议：

之前学习过，网际层向上层提供的是无连接不可靠传输服务，而UDP协议也是一样的，提供无连接不可靠传输服务，所以两个UDP发送方和接受方在数据传输的过程中，容易出现误码和丢失的情况，此时，就算是误码和丢弃的情况出现，发送方也不会做出处理，因为他进行的是无连接不可靠传输服务，因此，UDP协议使用于实时状态的应用，例如视频会议

TCP传输控制协议：

网际层向上传输无连接不可靠协议，但是TCP是可靠协议，TCP的接受方和发送方进行单播时，相当于建立了一条可靠信道，。所以不会出现UDP的情况，因此使用于文件传输。

---

两者首部对比：

![image-20210913233008862](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913233008862.png)

传输控制协议TCP

由于是可靠传输，所以首部字段比UDP首部字段复杂的多。

---

总结：

![image-20210913233213332](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913233213332.png)

***

### 4.TCP的流量控制

![image-20210913233907065](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210913233907065.png)

![image-20210914083522042](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914083522042.png)

主机A将发送数据给主机B ，主机B对主机A进行流量控制，也就是控制主机A发送数据的多少，还有是否应该发送数据。根据上图文字可知：主机A在发送201~300号数据时，数据发生了丢失。但是主机A还能再发送100字节的数据，此时主机B根据主机A丢失了数据，对主机A继续发送数据进行调控，将原来窗口调整为300，也就是接收窗口的接收量为300，对主机A进行流控。

待主机B接受完所有数据时，主机A对缓存中的1~200的字节数据全删除，因为已经收到了主机B对他们的累积确认。

![image-20210914084717943](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914084717943.png)

进行相同的操作，主机B对主机A进行了三次流量控制。

---

![image-20210914085326041](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914085326041.png)

上图所示：主机A和主机B发送数据结束以后，都将流量窗口的值都调为0，此时主机A与主机B之间会发送非零窗口通知，一开始，主机B 接收完所有数据之后就会向主机A发送一个零窗口通知，而主机A收到一个零窗口通知后，会启动一个持续计时器，当持续计时器超时，主机A立刻发送一个仅仅携带一个字节数据的零窗口探测报文段，向主机B进行检测，因为在发送零窗口通知时，容易造成数据丢失，从而要验证主机B时否接收到主机A发送的零窗口报文。

**![image-20210914090523804](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914090523804.png)**

注意：

TCP协议中规定：不论何时，只要是请求报文，紧急报文，，接收方都可以进行接收。

---

练习：

![image-20210914091054910](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914091054910.png)

---

总结：

 ![image-20210914091122278](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914091122278.png)

***

###  5.TCP的拥塞控制

![image-20210914092237920](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914092237920.png)

拥塞：

在某一段时间内，对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就要变坏。这种情况称之为 拥塞。

（资源：带宽，结点，缓存，处理机，，，，等等都是资源）

吞吐量：

吞吐量随着拥塞的增大而减小。

---

TCP控制的四种拥塞控制算法

![image-20210914093232866](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914093232866.png)

注意前提：

上图所示

![image-20210914151218982](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914151218982.png)

拥塞窗口CWND：

取决于网络的拥塞程度，并且动态变化，当没有出现拥塞的时候，拥塞窗口会变大，当出现拥塞窗口的时候，拥塞窗口会变小，拥塞窗口的动态变化，不断地控制着网络拥塞程度。

---

 ![image-20210914151829138](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914151829138.png)

拥塞窗口cwnd：

拥塞窗口的值到一定程度时，就要开始观察慢开始门限值

由于上图中拥塞窗口值为1，而发送窗口值等于拥塞窗口值，所以此时也就只能 发送一个TCP报文段，注意:拥塞窗口值为多大，也就是能发送几个TCP报文段。

![image-20210914152404667](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914152404667.png)

如图所示：发送方将发送TCP数据报文段给接收方，并且收到接收方发送的确认报文段，此时，拥塞窗口的值会增加1，

![image-20210914152625895](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914152625895.png)



![image-20210914152753367](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914152753367.png)



观察图标，第一次发送方将发送一个TCP报文段给接收方，而后增加1，再发送两个给接收方，而后增加2，再发送4个给接收方，而后增加4到8，再发送8个TCP报文段给接收方，增加到16，观察图标，已经达到了慢开始门限值，所以此时就要控制发送的速率了，    开始改用拥塞避免算法，也就是每次传输结束后，拥塞窗口值只能线性增加1，而不是像一开始那样成倍的增加，

例如：

![image-20210914153522525](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914153522525.png)



![image-20210914153534488](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914153534488.png)

在16窗口值之后，又进行了一次发送，但是这次增加的值为1，所以总值为17.

![image-20210914153858148](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914153858148.png)



上图为此次发送的TCP报文段

假设：这24个数据报文段在出传输过程中丢弃了几个 ，这一定会造成发送方对这些丢失报文段的超时重传，发送方依次判断网络可能出现了拥塞，需要进行一下工作，

![image-20210914154417764](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914154417764.png)



![image-20210914154515256](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914154515256.png)

![image-20210914154708145](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914154708145.png)

由上图分析可知：

慢开始：

指的是一开始向网络注入的报文段比较少，并不是拥塞窗口增长速度慢。

拥塞避免：并非能完全避免拥塞，而是指在拥塞避免阶段将拥塞窗口控制为按线性规律增长，使网络不容易出现拥塞。

分析过程：

一开始指数缓慢增长，增加到慢开始门限值后，增加速度为1，出现网络拥塞的情况后，将慢开始门限值更新为现在的一半，然后从0开始计算，再达到新的慢开始门限值后，进入拥塞避免阶段，增加速度为1，达到避免最大值后又有了新的慢开始门限值。

---

快重传的应用

![image-20210914160148189](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914160148189.png)

问题：

数据丢失会造成超时重传，让其误认为是网络拥塞，所以要进行更新慢开始门限值，重新计算拥塞窗口值。这样也就会导致原本没有网络拥塞的被误认为网络拥塞，降低了传输效率。

快重传作用：

![image-20210914160658600](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914160658600.png)



---

快重传算法：

![image-20210914161019258](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914161019258.png)

过程分析：

发送方会不断发送数据报文，接受方接收到数据报文后会进行确认报文的发送，而在发送方还未接收到确认报文时，依然进行下一个数据报文的发送，当发送方出现发送的数据报文丢失时，接收方自然收不到数据报文，也就不会进行确认报文的发送，此时属于第一次丢失，发送方会继续进行数据报文的发送法，这时，接收方发现接收到的数据报文顺序不对，此时接收方知道出现了数据丢失，就像发送方发送重复确认报告，这是第一次发送重复确认报告，接下来发送方继续发送下一个数据报文，接收方依然发送重复确认报告，这时第二次，接下来有第三次重复确认报告，这时发送方就会立即重传原来丢失的数据报，再接着之前的顺序继续发送，此时接收方会进行确认，确认完成，代表之前发送的数据都已经正确接收。

---

快恢复算法：

![image-20210914162223065](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914162223065.png)

接着快重传继续进行。

![image-20210914162434077](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914162434077.png)

---

练习题：

![image-20210914162511477](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914162511477.png)

---

总结：
![image-20210914162533187](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914162533187.png)

***

### 6.TCP超时重传时间的选择

![image-20210914163201248](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914163201248.png)

TCP报文互传时，传送的时间互不相同，这也就导致了超时重传时间的选择是咋样的，由多次测量得知，选择略大于往返时间的超时重传时间最好，计算公式如下：
![image-20210914163446654](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914163446654.png)

---

计算时间：

![image-20210914163623995](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914163623995.png)

![image-20210914163850010](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914163850010.png)

  出现超时重传时，无法确认是重传报文还是原来的报文，因此新的计算方法如下：

![image-20210914164107738](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914164107738.png)

举例：

![image-20210914164230303](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914164230303.png)



![image-20210914164336509](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914164336509.png)



---

总结：

![image-20210914164356036](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914164356036.png)

***

### 7.TCP可靠传输的实现

TCP的传输:

![image-20210914200950154](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914200950154.png)

发送方将数据发送给接收方，接收方会发送确认分组给发送方，以上图字节流为例子：

![image-20210914201345116](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914201345116.png)

发送方根据这两个字段的值构造出自己的发送窗口。RWND是指确认窗口为20，ACK指的是确认字段为31，也就是最后的字节为31，

![image-20210914201555285](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914201555285.png)

首先确认发送窗口的大小为20，前沿是靠近未发送的部分，后沿是靠近以发送的部分，发送窗口是可以移动的，根据前沿和后沿不同的情况，移动的距离是不同的。已经发送的数据是不动的，可以进行删除，但是该部分数据并不会移动。

假设：

发送方将发送窗口内序号31-41的数据封装在几个不同的报文段中发送出去。

那么如何描述发送窗口的状态。

![image-20210914202506969](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210914202506969.png)

其中31-41是已经发送还未收到确认数据报的状态，而42-50是发送的状态。

---

接收方的状态

![image-20210915121027821](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210915121027821.png)

![image-20210915121051240](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210915121051240.png)

![image-20210915121123481](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210915121123481.png)

![image-20210915121138994](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210915121138994.png)







---

TCP可靠传输实现的补充

![image-20210916085115939](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916085115939.png)

TCP通信时全双工通信，在进行发送数据的同时也进行着接收数据。

---

练习：

![image-20210916085557553](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916085557553.png)

首先主机甲和主机乙，进行TCP连接，这样两个主机才能进行数据连接，主机甲发送数据给主机乙，由题可知，进行连续两个报文段的发送，当发送完两个连续的报文段后，主机乙进行了正确接收，所以发送给甲的序号是1000

---

![image-20210916090259145](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916090259145.png)



---

总结：

![image-20210916090707467](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916090707467.png)



***

## 第八章

#### 1.TCP的运输连接管理——TCP的连接建立

![image-20210916091108016](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916091108016.png)



首先明确TCP的建立有三个阶段，第一阶段是：三报文握手 建立连接，第二阶段是：数据传输阶段，第三阶段是：四报文挥手 释放连接。

TCP的运输连接管理就是使运输连接的建立和释放都能正常进行。

---

TCP连接的建立

![image-20210916091630430](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916091630430.png)



![image-20210916091918262](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916091918262.png)



![image-20210916091952122](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916091952122.png)



![image-20210916092056447](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916092056447.png)

 ![image-20210916092119180](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916092119180.png)

![image-20210916092230623](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916092230623.png)



TCP连接的建立：

首先发送端的应用进程发送TCP建立的请求，这样，发送端也被称为TCP客户，而接收端也就被称为TCP服务器，发送过程：首先TCP客户进行TCP发送请求，然后通过三报文握手建立传输控制块，一开始的传输时关闭的，只有TCP客户端主动进行请求发送，数据传输通道才会打开

再来看接收端，称为TCP服务器，它也会有传输控制块的建立，不过都是被动的，此时它会进行监听功能，随时监听发送端的状态，进行接收数据。

再来看：发送端发送的SYN ，当SYN设置为1时，表明该报文段不能携带数据，但是要消耗一个序号，seq是序号字段。

TCP的连接建立是主动开启的，因此又称为主动打开连接。

![image-20210916094201811](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916094201811.png)

---

![image-20210916094649485](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916094649485.png)

由图分析过程:

首先TCP客户端主动进行请求连接，主动打开连接通道，将请求数据发送到TCP服务器中，TCP服务器对其进行接收，接收完毕之后又发送针对TCP请求连接的确认，当客户端已经成功接收后，还要再次进行普通TCP请求的发送，这时发送的是普通的TCP请求报文，此时注意发送的SEQ=X+1，因为就客户端第一次发送的SEQ=X，所以这时第二次发送数据了，序号就要加1.ACK是请求确认。经过两次的TCP主动请求连之后，服务器发送的确认数据也被客户端成功接收，此时两者时间的建立已经成功的建立起来了。

问题：

为什么经过第一次TCP请求确认后还要进行一次确认呢，不会多余吗？

答：

举例说明：

![image-20210916100325086](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916100325086.png)



分析：

如果不进行普通TCP请求的话 ，那么就是二报文握手连接，例如：客户端发送一个TCP连接请求给服务器，服务器接收到该数据后就直接进入已连接状态，假设出现TCP请求连接失败的情况，那么服务器就会接收不到第一次发送的请求连接，此时客户端再次发送TCP请求连接，服务器接收成功后就直接进入已建立状态，然后进行数据传输，和释放连接，此时第一次TCP连接请求又发送成功了，服务器不知道这是第一次的发送请求，会误认为是最新的发送请求，于是又建立一个新的连接，这样就是浪费了资源。

综上所述：采用三报文握手进行连接会对资源进行更好的利用

![image-20210916102226017](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916102226017.png)

---

练习题

![image-20210916102342060](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916102342060.png)

---

总结：

![image-20210916102403668](C:\Users\yxl\AppData\Roaming\Typora\typora-user-images\image-20210916102403668.png)

---

### 2.TCP的运输连接管理——TCP的连接释放















































































































































































































































































































































































































































































